
# <center>中小微企业的信贷决策</center>

## <center>摘要</center>

&emsp;本文针对银行对于中小微企业的信贷决策问题，基于蒙特卡洛模拟，马科维茨投资理论，回归统计模型，为银行设计了合理的投资组合，给出了最佳贷款年利率，最优贷款公司组合及其贷款权重的贷款方案。

**关键词：** 投资组合优化，蒙特卡洛模拟，马科维兹投资理论，回归统计模型，期望收益，风险分析，夏普比率，协方差，中小微企业，信贷决策

<div style="page-break-after:always;"></div>

## <center>一、问题重述</center>

&emsp;实际生活中，银行以信贷政策、企业的票据信息和上下游企业在业内的影响力为根据对实力强、供求稳定的企业提供贷款服务并根据风险对企业给予利率优惠。银行首先要对企业的实力和风险进行评估，进而依据信贷风险等因素来确定其信贷策略。

&emsp;某银行对确定要放贷企业的贷款额度为10~100万元，年利率为4%~15%；贷款期限为1年。

&emsp;附件1~3给出了123家有信贷记录企业的相关数据、302家无信贷记录企业的相关数据和贷款利率与客户流失率关系的2019年统计数据。现在需要根据实际和附件中的数据信息，通过建立数学模型研究对中小微企业的信贷策略，主要解决以下三个问题：

&emsp;(1) 对附件1中123家企业的信贷风险进行量化分析，并在年度信贷总额固定的情况下，给出该银行对这些企业的信贷策略。

&emsp;(2) 在问题1的基础上，对附件2中302家企业的信贷风险进行量化分析，并在年度信贷总额为一亿元的情况下，给出该银行对这些企业的信贷策略。

&emsp;(3) 企业的生产经营和经济效益可能会受到一些突发因素的影响，并且突发因素往往对不同类别、不同行业的企业带来不同的影响。现要根据附件2中各企业的信贷风险和可能的突发因素（例如：新冠病毒疫情）对各企业的影响，给出该银行在年度信贷总额为1亿元时的信贷调整策略。

## <center>二、问题分析</center>

&emsp;本文要解决的是银行在年度贷款总额确定的情况下，如何对企业制定合适的信贷策略的问题。问题一要求我们对附件一中的企业的信贷风险进行分析，从而制定出银行在固定年度贷款总额的情况下，应实行的信贷策略。问题二则建立在问题一的基础上，给出具体的年度贷款总额1亿元，并对附件二中的企业进行分析，得出相应的信贷策略。而问题三则引入突发因素，并要综合考虑附件二中会出现的信贷风险和可能出现的突发因素，给出在这种情况下银行要做出的信贷调整策略。

<img src="C:\Users\23919\Desktop\ren\整体求解思路.png" style="zoom: 33%;" />

<center>图1 整体解决思路流程图</center>

&emsp;本文要解决的是银行在年度贷款总额确定的情况下，如何对企业制定合适的信贷策略的问题。问题一要求我们对附件一中的企业的信贷风险进行分析，从而制定出银行在固定年度贷款总额的情况下，应实行的信贷策略。问题二则建立在问题一的基础上，给出具体的年度贷款总额1亿元，并对附件二中的企业进行分析，得出相应的信贷策略。而问题三则引入突发因素，并要综合考虑附件二中会出现的信贷风险和可能出现的突发因素，给出在这种情况下银行要做出的信贷调整策略。

### 2.1 问题一的分析
&emsp;针对问题一，我们将信贷策略分为两个考虑层面：期望收益与风险分析，即制定的策略要满足达到一定程度上的最高期望收益，并且风险不能过高。

&emsp;首先，期望收益取决于贷款年利率、客户违约率、贷款额、信誉评级以及客户流失率。其中，在附件一中，通过频率估计概率的方法，建立了客户违约率和信誉评级之间的联系；在附件三中，我们通过建立统计回归模型，得到了客户流失率关于贷款年利率在不同信誉评级下的回归方程，通过对期望收益效率表达式的变量代换以及求导操作，得出最佳贷款年利率，将其带回期望收益效率表达式，从而获得最佳期望收益效率值。再者，为了确定银行的最佳期望收益，通过附件一的数据，我们估算了每家企业的期望贷款额，并乘以上述得出的最佳期望收益效率值，得到银行的最佳期望收益。

&emsp;对于风险分析，我们将风险分为三个考虑层面：期望收益的方差，协方差以及公司的信誉情况。期望收益的方差体现出了企业的收益稳定情况；协方差体现了企业组合之间的联系以及收益的相关性强弱；企业的信誉情况通过信誉等级、是否违约以及公司财力来体现。

&emsp;最终，通过马科维茨投资组合理论算法，将银行对于各个公司的最佳期望收益以及需要承担的风险作为算法输入，从而得到最优解。

### 2.2 问题二的分析

&emsp;针对问题二，年度信贷总额被固定为一亿元，每个公司的贷款额度被限定在10万到100万之间，我们需要在问题一的基础上进行求解。所以每个公司贷款占信贷总额的比例被限定为
$$
\{r|r=0\ 或\  0.001<r<0.01\}
$$
&emsp;根据问题一的结论得到最佳的收益效率，在此基础上通过附录2中每个公司销项发票信息与进项发票信息得到相应的期望效率，绘制出累计收益曲线，计算每个公司组合的相关系数，为了便于观察，我们将数值的相关矩阵用热图的形式展现了出来。此外，我们计算出了每个公司期望收益之间的协方差矩阵得出组合的波动情况。以此为基础上对每个公司贷款给予相应的比重并得出标准差，用来衡量贷款组合的风险。

&emsp;之后通过蒙特卡洛模拟对马科维茨模型进行了10000次模拟，以横坐标为风险的标准差、纵坐标为收益率将每一种组合的收益和标准差绘制成散点图。最后我们通过风险最小组合以及夏普比率最优组合得出了两种最优的优化策略（每个公司的最优贷款比重、金额数以及年利率）。

### 2.3 问题三的分析

&emsp;针对问题三，题目中加入了对突发因素的考虑。根据题目提供的信息，作废发票是因故作废的发票，可以作为突发因素加入到期望收益的考量中，并通过计算每个公司的作废率，并将其与贷款额结合，再与问题二得出的结论比较。

&emsp;除此之外，再次考虑其他突发因素，例如新型冠状病毒疫情，美国限华政策。新型冠状病毒对旅游，食品和娱乐行业有着较为严重的影响，此时银行应调整贷款利率；美国限华政策对科技，军工企业有一定的影响，银行也应作出一定的策略调整。

## <center>三、基本假设</center>

1.假设一：企业制定信贷策略时仅考虑期望收益和所要承受的风险。

2.假设二：不同信誉等级对应的违约率为不同的常数（通过频率估计概率来确定）。

3.假设三：企业的贷款能力通过销项发票与进项发票的价税合计之差来体现。

4.假设四：客户流失率关于贷款年利率在不同信誉评级下的回归方程的最大次项为二次。

5.假设五：信誉评级为D的公司银行不予提供贷款服务。

6.假设六：在问题二，问题三中，贷款年利率，期望效率取信誉评级A，B，C情况下的均值。

7.假设七：在问题三中，以频率估计概率得到每家企业的发票作废率。

## <center>四、变量说明</center>
| 符号         | 意义                                                   | 单位     |
| ------------ | ------------------------------------------------------ | -------- |
| $r_i$        | 贷款年利率                                             | 无       |
| $r_a$        | 客户流失率                                             | 无       |
| $(r_i)_k$    | 第$k$个信誉评级不为D的公司的贷款年利率                 | 无       |
| $(r_a)_k$    | 第$k$个信誉评级不为D的公司的客户流失率                 | 无       |
| $q_k$        | 第$k$个信誉评级不为D的公司的期望贷款                   | 万元     |
| $p_A$        | 信誉评级为$A$的公司的违约概率                          | 无       |
| $p_B$        | 信誉评级为$B$的公司的违约概率                          | 无       |
| $p_C$        | 信誉评级为$C$的公司的违约概率                          | 无       |
| $p_k$        | 第$k$个信誉评级不为D的公司的违约概率                   | 无       |
| $E_k$        | 第$k$个信誉评级不为D的公司期望收益                     | 万元     |
| $D(E_k)$     | 期望收益的方差                                         | $万元^2$ |
| $\eta_k$     | $期望收益效率=\frac{期望收益}{贷款}$                   | 无       |
| $Sharpratio$ | 夏普比率$=\frac{投资组合的期望收益}{投资组合的标准差}$ | 无       |
| $W_k$        | 第$k$个公司的投资权重                                  | 无       |

<center>表1 符号约定</center>
## <center>五、模型建立与求解</center>

### 5.1 问题一 

#### 5.1.0 解决思路流程图

####  <img src="C:\Users\23919\Desktop\ren\第一题流程图.jpg" style="zoom:200%;" />

<center>图1 问题一解决思路流程图</center>

#### 5.1.1 客户流失率与银行贷款年利率的回归统计模型 

&emsp;本小节通过分析客户流失率与银行贷款率的回归统计模型来建立一种特定的函数关系以便后续的计算。因此，我们根据附录三中的统计数据画出了年利率$r_i$与客户流失率$r_a$的散点图：

![](C:\Users\23919\Desktop\ren\sandian.jpg)

<center>图1 客户流失率与年利率散点图</center>

&emsp;我们知道，客户流失率与年利率的线性模型：
$$
r_i=\beta_0+\beta_1r_a+\epsilon
$$
&emsp;从散点图来看，客户流失率与年利率接近二次函数模型：
$$
r_i=\beta_0+\beta_1r_a+\beta_2r_a^2+\epsilon
$$
&emsp;结合以上两个模型得到回归模型：
$$
r_i=\beta_0+\beta_1r_a+\beta_2r_a+\beta_3r_a^2+\epsilon
$$
&emsp;其中， $r_i$与$r_a$分别为年利率与客户流失率，$\epsilon$为随机误差，$\beta_0$，$\beta_1$，$\beta_2$，$\beta_3$为回归系数。对A,B,C三种信誉评级求解回归参数，可以得出以下三个参数估计表（其中，置信水平$\alpha=0.05$）：
***
|参数|参数估计|参数置信区间|
|---|---|---|
|$\beta_0$|-0.6971|[-0.7725,-0.6217]|
|$\beta_1$|21.9844|[20.2618,23.7071]|
|$\beta_2$|0|[0,0]|
|$\beta_3$|-76.4101|[-85.404,-67.4162]|
>决定系数$R^2=1$, $ F$统计量$F=1847.9$, $F$统计量对应概率值$p=0$, 剩余方差$s^2=0$;
<center>表2 信誉评级A的回归参数</center>

***
|参数|参数估计|参数置信区间|
|---|---|---|
|$\beta_0$|-0.6504|[-0.7153,-0.5856]|
|$\beta_1$|20.2072|[18.7246,21.6898]|
|$\beta_2$|0|[0,0]|
|$\beta_3$|-67.9331|[-75.6735,-60.1927]|
>决定系数$R^2=1$, $ F$统计量$F=2347.6$, $F$统计量对应概率值$p=0$, 剩余方差$s^2=0$;
<center>表3 信誉评级B的回归参数</center>

***
|参数|参数估计|参数置信区间|
|---|---|---|
|$\beta_0$|-0.6393|[-0.7011,-0.5775]|
|$\beta_1$|19.5693|[18.1568,20.9818]|
|$\beta_2$|0|[0,0]|
|$\beta_3$|-63.9422|[-71.3168,-56.5676]|
<center>表4 信誉评级C的回归参数</center>
>决定系数$R^2=1$, $ F$统计量$F=2643.3$, $F$统计量对应概率值$p=0$, 剩余方差$s^2=0$;

***
&emsp;可以看出，上述三表中的决定系数$R^2$无限趋近于1，剩余方差$s^2$无限趋近于0，$F$统计量远远超过$F$检验的临界值，$p$远远小于$\alpha$, 可以看出对于年利率与客户流失率构造的统计回归模型十分成功。
&emsp;于是，可以进而得出年利率 $r_i$与客户流失率$r_a$的函数关系式：
$$
\left\{  
             \begin{array}{**lr**}  
             信誉评级 A：r_a=-0.6971+21.9844r_i-76.4101r_i^2, &  \\  
             信誉评级 B：r_a=-0.6504+20.2072r_i-67.9331r_i^2, & 0\leq r_i\leq 1 , 0\leq r_a\leq 1\\  
             信誉评级 C：r_a=-0.6393+19.5693r_i-63.9422r_i^2, &    
             \end{array}  
\right.
$$
&emsp;当然，还可以画出回归方程的图像进行更加直观的观察，如下图所示：

![](C:\Users\23919\Desktop\ren\huigui.jpg)

<center>图2 客户流失率与年利率统计回归图</center>

&emsp;从图中也可以看到，统计回归模型构造的十分成功。

#### 5.1.2 不同信誉评级的违约率求解

&emsp;信誉评级$A,B,C$对应的违约率$p_A,p_B,p_C$都近似为常数，可以通过频率估计概率求解。（根据往年不同信誉评级的公司的违约情况估计）

<img src="C:\Users\23919\Desktop\ren\违约率.png" style="zoom: 150%;" />

<center>图3 不同信誉评级对应的违约率</center>

#### 5.1.3 最佳年利率

&emsp;在本小节，我们需要计算每一个公司的期望收益以及最大期望收益。利用前文已经得到的客户流失率$r_a$与贷款年利率$r_i$的关系可以轻松使用$r_i$表示$r_a$，我们有：
$$
\begin{aligned}
r_a&=c+br_i+ar_i^2+\epsilon \\
&=ar_i^2+br_i+c \quad(令\epsilon=0，a,b,c为常数，由前文导出公式以及信誉评级决定)
\end{aligned}
$$
&emsp;另外，我们有，对于任意一个公司(第$k$个信誉评级不为D的公司)，其期望贷款额为$q_k$，那么银行在这个公司的一年的期望收益$E_k$可以表示为（**需要注意，在本小节暂时把第k个公司的贷款额$q_k$当作常数**）：
$$
\begin{aligned}
E_k&=(第k个公司的银行贷款)*(第k个公司的贷款年利率)*(1-第k个公司的客户流失率)*(1-第k个公司的违约率)\\
&=q_k*(r_i)_k*[1-(r_a)_k]*(1-p_k)\\
&=q_k*(r_i)_k*\{1-a_k(r_i)_k^2-b_k(r_i)_k-c_k\}*(1-p_k)
\end{aligned}
$$
+ 其中，根据**5.1.1**中的结论，我们有：
$$
\left\{               \begin{array}{**lr**}               信誉评级 A：a_k=-76.4101,b_k=21.9844,c_k=-0.6971, &  \\               信誉评级 B：a_k=-67.9331,b_k=20.2072,c_k=-0.6504,& \\               信誉评级 C：a_k=-63.9422,b_k=19.5693,c_k=-0.6393, &                 \end{array}  \right.
$$
+ 根据**5.1.2**中的结论，我们还有：
  $$
  \left\{               \begin{array}{**lr**}               信誉评级 A：p_k=p_A=0, &  \\               信誉评级 B：p_k=p_B=0.0263,& \\               信誉评级 C：p_k=p_C=0.0588, &                 \end{array}  \right.
  $$
&emsp;进一步的，我们还可以定义第$k$个公司的期望收益效率$\eta_k$如下:  
$$
\begin{aligned}
\eta_k&=\frac{第k个公司的期望收益}{第k个公司的银行贷款}\\
&=\frac{E_k}{q_k}\\
&=\frac{q_k*(r_i)_k*\{1-a_k(r_i)_k^2-b_k(r_i)_k-c_k\}*(1-p_k)}{q_k}\\
&=(r_i)_k*\{1-a_k(r_i)_k^2-b_k(r_i)_k-c_k\}*(1-p_k)
\end{aligned}
$$
&emsp;画出期望收益效率随年利率变化的图像如下：

![](C:\Users\23919\Desktop\ren\三次函数.jpg)

<center>图4 期望收益效率随年利率变化的曲线</center>

&emsp;可以观察到：
+ 选择具有更大的期望收益效率的公司可以为银行提供更多的盈利。

+ 可以通过$d\eta_k/d(r_i)_k=0$求解$(r_i)_k$的最优解。

+ $$
  \begin{aligned}
  d\eta_k/d(r_i)_k=(1-p_k)\{-3a_k[(r_i)_k]^2-2b_k(r_i)_k+1-c_k\}=0
  \end{aligned}
  $$
  
+ 我们可以得到两个解：$(r_i)_k=\frac{2b_k\pm \sqrt[]{4b_k^2+12(1-c_k)a_k}} {-6a_k}$,由上图所示，该三次函数曲线先增再减再增的图像性质，舍去其中一个解。可以得到：
  + 当$(r_i)_k=\frac{2b_k- \sqrt[]{4b_k^2+12(1-c_k)a_k}} {-6a_k}$时，期望收益$E_k$,期望收益效率$\eta_k$最大。
  + 将信誉评级A,B,C的数据分别代入，最终的最大化期望收益效率的解：
  $$
  \left\{               \begin{array}{**lr**}               信誉评级 A：(r_i)_k=0.0535,Max(\eta_k)=0.0396 &  \\               信誉评级 B：(r_i)_k=0.0575,Max(\eta_k)=0.0399& \\               信誉评级 C：(r_i)_k=0.0589,Max(\eta_k)=0.0393 &                 \end{array}  \right.
  $$
  + 画出三组解在曲线中的位置进行验证，可以看出这组解确实最大化了期望收益效率：
  + 
  ![](C:\Users\23919\Desktop\ren\贷款年利率的选择.jpg)
  
  <center>图5 贷款年利率的选择</center>

  &emsp;所以，在不考虑公司贷款能力的情况下，为最大化期望收益以及期望收益效率，应该将贷款年利率$r_i$尽量控制在0.0535（信誉评级A的企业），0.0575（信誉评级B的企业），或0.0589（信誉评级C的企业）左右。
  

&emsp;另外，由于各个信誉评级对应的最佳贷款年利率以及最佳期望效率差别不大，在公司的信誉评级未知的情况下，我们可以直接取平均值来估算：
$$
  \left\{               \begin{array}{**lr**}               (r_i)_k=\frac{0.0535+0.0575+0.0589}{3}=0.0566 &  \\               Max(\eta_k)=\frac{0.0396+0.0395+0.0393}{3}=0.0395& \\                              \end{array}  \right.
$$

#### 5.1.4 期望贷款额

&emsp;由**5.1.3**的结论可以得出：
$$
E_k=\eta_kq_k
$$
&emsp;所以为了计算每一个公司的期望收益,需要得到每个公司的期望贷款额$q_k$，$q_k$可以由该公司往年的进项发票信息，销项发票信息决定。这里本文采用如下公式进行估计：
$$
\begin{aligned}
q_k&=\frac{2017下半年到2019年末公司利润}{2.5年}\\
&=\frac{\sum(第k个公司销项价税合计)-\sum(第k个公司进项价税合计)}{30个月}
\end{aligned}
$$
&emsp;我们因此可以计算出期望收益矩阵(以下为截取的部分，具体见支撑材料)：

<img src="C:\Users\23919\Desktop\ren\Q1_期望收益.png" style="zoom: 25%;" />

<center>表5 期望收益</center>

#### 5.1.5 风险分析

&emsp;在最大化期望收益的同时，我们还需要尽量的降低收益的风险。根据前文的分析，收益的风险组要体现在以下三个方面：

+ 期望收益的方差

+ 期望收益的协方差

+ 公司的信誉情况

&emsp;一般的，期望收益的方差越大，表明期望收益的波动越大，也表明该贷款组合的风险越大。贷款组合的协方差越大，表明该贷款组合的相关性越高，越是容易出现“一起赚很多，或一起亏很多”的情况，同样也表明了该贷款组合的风险很大。

&emsp;我们可以算出期望收益相关系数矩阵(以下为截取的部分，具体见支撑材料)：

![](C:\Users\23919\Desktop\ren\Q1_协方差.png)

<center>表5 期望收益相关系数矩阵</center>

&emsp;对收益相关系数矩阵可视化处理以更直观显示相关系数的分布：

![](C:\Users\23919\Desktop\ren\相关系数可视化.jpg)

<center>图6 相关系数矩阵可视化</center>

#### 5.1.6 马科维茨投资组合理论

&emsp;前文已经分析出了给公司贷款选择的最佳年利率, 为了确定完整的信贷决策，我们还需要确定选择的公司以及所选择的公司贷款的权重。

&emsp;一个简单的方法是使用马科维茨投资组合理论，其输入输出表如下图所示：

| 输入                               | 输出                                         |
| ---------------------------------- | -------------------------------------------- |
| 在各个公司的期望收益(期望收益矩阵) | （1）选择的公司（2）以及所选择公司贷款的权重 |

<center>表6 马科维茨投资组合理论算法输入输出表</center>

&emsp;由于本题没有给出具体的信贷总额，所以本小节仅仅提出马科维茨投资组合理论的方法，而具体的方法在题目二，题目三中求解。

### 5.2 问题二 



### 5.3 问题三




## <center>六、模型检验&模型评价</center>





## <center>参考文献</center>

[1]姜启源，大学数学实验，[M]  ，清华大学出版社。


## <center>附录</center>

### 附录一 问题一客户流失率与银行贷款年利率的回归统计模型MATLAB代码
```matlab
clear;
irar=xlsread('C:\Users\23919\Desktop\CUMCM2020Probelms\C\附件3：银行贷款年利率与客户流失率关系的统计数据.xlsx',1);
%年利率ir 客户流失率ar
ir=irar(:,1);
ar_A=irar(:,2);
ar_B=irar(:,3);
ar_C=irar(:,4);
figure(1);
subplot(131),plot(ir,ar_A,'b','LineStyle','none','Marker','.','MarkerSize',1),xlabel('年利率r_i'),ylabel('客户流失率r_a');
subplot(132),plot(ir,ar_B,'k','LineStyle','none','Marker','.','MarkerSize',1),xlabel('年利率r_i'),ylabel('客户流失率r_a');
subplot(133),plot(ir,ar_C,'r','LineStyle','none','Marker','.','MarkerSize',1),xlabel('年利率r_i'),ylabel('客户流失率r_a');
figure(2);
plot(ir,ar_A,'b','Marker','.','MarkerSize',10);
hold on;
plot(ir,ar_B,'k','Marker','.','MarkerSize',10);
plot(ir,ar_C,'r','Marker','.','MarkerSize',10),xlabel('年利率r_i'),ylabel('客户流失率r_a');
legend('信誉评级A','信誉评级B','信誉评级C');
figure(3);
plot(ir,ar_A,'b','LineStyle','none','Marker','.','MarkerSize',10);
hold on;
plot(ir,ar_B,'k','LineStyle','none','Marker','.','MarkerSize',10);
plot(ir,ar_C,'r','LineStyle','none','Marker','.','MarkerSize',10),xlabel('年利率r_i'),ylabel('客户流失率r_a');
legend('信誉评级A','信誉评级B','信誉评级C');

[b1,bint1,r1,rint1,stats1]=regress(ar_A,[ones(29,1) ir ir ir.^2],0.05)
[b2,bint2,r2,rint2,stats2]=regress(ar_B,[ones(29,1) ir ir ir.^2],0.05)
[b3,bint3,r3,rint3,stats3]=regress(ar_C,[ones(29,1) ir ir ir.^2],0.05)

f1=b1(1)*ones(29,1)+(b1(2)+b1(3))*ir+b1(4)*ir.^2;
f2=b2(1)*ones(29,1)+(b2(2)+b2(3))*ir+b2(4)*ir.^2;
f3=b3(1)*ones(29,1)+(b3(2)+b3(3))*ir+b3(4)*ir.^2;

figure(4);
plot(ir,ar_A,'b','LineStyle','none','Marker','.','MarkerSize',10);
hold on;
plot(ir,ar_B,'k','LineStyle','none','Marker','.','MarkerSize',10);
plot(ir,ar_C,'r','LineStyle','none','Marker','.','MarkerSize',10),xlabel('年利率r_i'),ylabel('客户流失率r_a');
plot(ir,f1,'b');
plot(ir,f2,'k');
plot(ir,f3,'r');
legend('信誉评级A','信誉评级B','信誉评级C','信誉评级A','信誉评级B','信誉评级C');
```
### 附录二 问题一最佳年利率MATLAB代码

```matlab
clear;
ak=[-76.4101 -67.9331 -63.9422];
bk=[21.9844 20.2072 19.5693];
ck=[-0.6971 -0.6504 -0.6393];
p=[0 0.0263 0.0588]
rik=(2.*bk-sqrt(4.*bk.^2+12*(1-ck).*ak))./(-6*ak)
eta=rik.*(1-ak.*(rik).^2-bk.*rik-ck).*(1-p)
ir=linspace(0.04,0.15,29);
figure(1);
f1=ir.*(1-ak(1)*ir.^2-bk(1)*ir-ck(1)).*(1-p(1));
f2=ir.*(1-ak(2)*ir.^2-bk(2)*ir-ck(2)).*(1-p(2));
f3=ir.*(1-ak(3)*ir.^2-bk(3)*ir-ck(3)).*(1-p(3));
plot(ir,f1,'b');
hold on;
plot(ir,f2,'r');
plot(ir,f3,'k');xlabel('贷款年利率r_i'),ylabel('期望收益效率\eta');
legend('信誉评级A','信誉评级B','信誉评级C');


figure(2);
subplot(131),plot(ir,f1,'b'),hold on;text(rik(1),eta(1),['(' num2str(rik(1)) ',' num2str(eta(1)) ')']),
plot(rik(1),eta(1),'ko','markerfacecolor','b'),
xlabel('贷款年利率r_i'),ylabel('期望收益效率\eta');title('信誉评级A');ylim([0.015 0.041]);
hold off;
subplot(132),plot(ir,f2,'r'),hold on;text(rik(2),eta(2),['(' num2str(rik(2)) ',' num2str(eta(2)) ')']),
plot(rik(2),eta(2),'ko','markerfacecolor','r'),
xlabel('贷款年利率r_i'),ylabel('期望收益效率\eta');title('信誉评级B');ylim([0.02 0.041]);
hold off;
subplot(133),plot(ir,f3,'k'),hold on;text(rik(3),eta(3),['(' num2str(rik(3)) ',' num2str(eta(3)) ')']),
plot(rik(3),eta(3),'ko','markerfacecolor','k'),
xlabel('贷款年利率r_i'),ylabel('期望收益效率\eta');title('信誉评级C');ylim([0.019 0.041]);
```

### 附录三 问题一期望协方差Python代码（合）

```python
## 导入基础类库
import pandas as pd
import numpy as np
data1 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='企业信息')
data2 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='进项发票信息')
data3 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='销项发票信息')
income = pd.merge(data1,data2,on='企业代号')
expense = pd.merge(data1, data3, on = '企业代号')
```
```python
from datetime import datetime
income['开票日期'] = pd.to_datetime(income['开票日期'], format='%Y-%m-%d %H:%M:%S')
income['date']=income['开票日期']
income['date'] =income['date'].apply(lambda x:datetime.strftime(x,'%Y-%m'))

expense['开票日期'] = pd.to_datetime(expense['开票日期'], format='%Y-%m-%d %H:%M:%S')
expense['date']=expense['开票日期']
expense['date'] =expense['date'].apply(lambda x:datetime.strftime(x,'%Y-%m'))
```

```python
income
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

</div>

```python
expense
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

</div>

```python
company_out = income[income['发票状态'] == '有效发票'].groupby(['企业代号','date']).sum().reset_index()
company_out = company_out.set_index("date")
company_in = expense[expense['发票状态'] == '有效发票'].groupby(['企业代号','date']).sum().reset_index()
company_in = company_in.set_index("date")
```


```python
company_out
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

</div>

```python
company_in
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

</div>

```python
company_data_t = pd.merge(company_in, company_out, how='outer', on=['企业代号','date'])
company_data_t = company_data_t.fillna(0)
company_data_t['profit'] = company_data_t['价税合计_y'] - company_data_t['价税合计_x']
company_data_t
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>

</div>


```python
company_data_t = pd.merge(company_in, company_out, how='outer', on=['企业代号','date'])
company_data_t = company_data_t.fillna(0)
company_data_t['profit'] = company_data_t['价税合计_y'] - company_data_t['价税合计_x']
company_data_t
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

</div>


```python
company_data = company_data_t.reset_index()[['date', '企业代号', 'profit']]
company_data = company_data.set_index("date")
company_data["profit_sum"] = company_data["profit"].cumsum(axis=0)
company_data["profit_sum"] = company_data["profit"]*efficiency
company_data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

</div>

```python
# 创建空的DataFrame变量，用于存储公司数据
CompanyProfit = pd.DataFrame()

#profit_value_list=[]  #存储每个公司的平均市值

# 创建公司代号的列表
company_list = data1['企业代号'].tolist()
# 使用循环，挨个获取每只股票的数据，并存储每日收盘价
for company in company_list:
    company_profit = company_data[company_data['企业代号'] == company]
    
    CompanyProfit[company] = company_profit['profit_sum']  #获取每个公司的利润
    #将每个公司的利润存入列表中
    #profit_value_list.append(stock_data['市值'].mean())

CompanyProfit.index.name = 'date'  #日期为索引列
# 输出数据的前5行
for column in list(CompanyProfit.columns[CompanyProfit.isnull().sum() > 0]):
    mean_val = CompanyProfit[column].mean()
    CompanyProfit[column].fillna(mean_val, inplace=True)

CompanyProfit
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

</div>




```python
CompanyReturns = CompanyProfit.pct_change().fillna(0)

company_return = CompanyReturns.copy()

CompanyReturns
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

</div>




```python
# 计算相关矩阵
correlation_matrix = company_return.corr()
# 输出相关矩阵
correlation_matrix
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

### 附录四 问题一相关系数矩阵可视化
```matlab
clear;
cov=xlsread('C:\Users\23919\Desktop\cov.xls',1);
x=1:123;%公司E1到E123
y=1:123;
[X,Y]=meshgrid(x,y);
mesh(X,Y,cov);
xlabel('公司编号'),ylabel('公司编号'),zlabel('公司E_x与公司E_y的相关系数');
```
