```python
## 导入基础类库
import pandas as pd
import numpy as np
data1 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='企业信息')
data2 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='进项发票信息')
data3 = pd.read_excel("D:\OneDrive\桌面\model\附件1：123家有信贷记录企业的相关数据.xlsx", sheet_name='销项发票信息')
income = pd.merge(data1,data2,on='企业代号')
expense = pd.merge(data1, data3, on = '企业代号')
```


```python
income
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>信誉评级</th>
      <th>是否违约</th>
      <th>发票号码</th>
      <th>开票日期</th>
      <th>销方单位代号</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
      <th>发票状态</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>3390939</td>
      <td>2017-07-18</td>
      <td>A00297</td>
      <td>-943.40</td>
      <td>-56.60</td>
      <td>-1000.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>3390940</td>
      <td>2017-07-18</td>
      <td>A00297</td>
      <td>-4780.24</td>
      <td>-286.81</td>
      <td>-5067.05</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>3390941</td>
      <td>2017-07-18</td>
      <td>A00297</td>
      <td>943.40</td>
      <td>56.60</td>
      <td>1000.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>3390942</td>
      <td>2017-07-18</td>
      <td>A00297</td>
      <td>4780.24</td>
      <td>286.81</td>
      <td>5067.05</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>9902669</td>
      <td>2017-08-07</td>
      <td>A05061</td>
      <td>326.21</td>
      <td>9.79</td>
      <td>336.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>210942</th>
      <td>E122</td>
      <td>***商贸有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>54706234</td>
      <td>2019-04-17</td>
      <td>A08967</td>
      <td>223.30</td>
      <td>6.70</td>
      <td>230.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>210943</th>
      <td>E122</td>
      <td>***商贸有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>55721344</td>
      <td>2020-01-10</td>
      <td>A09184</td>
      <td>264.15</td>
      <td>15.85</td>
      <td>280.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>210944</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>38493295</td>
      <td>2017-12-15</td>
      <td>A03624</td>
      <td>264.15</td>
      <td>15.85</td>
      <td>280.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>210945</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>95472001</td>
      <td>2018-12-29</td>
      <td>A03626</td>
      <td>264.15</td>
      <td>15.85</td>
      <td>280.00</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>210946</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>54469883</td>
      <td>2019-12-18</td>
      <td>A03626</td>
      <td>264.15</td>
      <td>15.85</td>
      <td>280.00</td>
      <td>有效发票</td>
    </tr>
  </tbody>
</table>
<p>210947 rows × 11 columns</p>
</div>




```python
expense
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>信誉评级</th>
      <th>是否违约</th>
      <th>发票号码</th>
      <th>开票日期</th>
      <th>购方单位代号</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
      <th>发票状态</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>11459356</td>
      <td>2017-08-04</td>
      <td>B03711</td>
      <td>9401.71</td>
      <td>1598.29</td>
      <td>11000.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>5076239</td>
      <td>2017-08-09</td>
      <td>B00844</td>
      <td>8170.94</td>
      <td>1389.06</td>
      <td>9560.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>5076240</td>
      <td>2017-08-09</td>
      <td>B00844</td>
      <td>8170.94</td>
      <td>1389.06</td>
      <td>9560.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>5076241</td>
      <td>2017-08-09</td>
      <td>B00844</td>
      <td>4085.47</td>
      <td>694.53</td>
      <td>4780.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>5076242</td>
      <td>2017-08-09</td>
      <td>B00844</td>
      <td>4085.47</td>
      <td>694.53</td>
      <td>4780.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>162479</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>8887701</td>
      <td>2019-12-17</td>
      <td>B10944</td>
      <td>4827.67</td>
      <td>144.83</td>
      <td>4972.5</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>162480</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>8887702</td>
      <td>2019-12-17</td>
      <td>B10944</td>
      <td>7412.62</td>
      <td>222.38</td>
      <td>7635.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>162481</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>34173085</td>
      <td>2019-12-17</td>
      <td>B13093</td>
      <td>1917.47</td>
      <td>57.53</td>
      <td>1975.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>162482</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>8887703</td>
      <td>2019-12-25</td>
      <td>B13093</td>
      <td>7252.42</td>
      <td>217.58</td>
      <td>7470.0</td>
      <td>有效发票</td>
    </tr>
    <tr>
      <th>162483</th>
      <td>E123</td>
      <td>***创科技有限责任公司</td>
      <td>D</td>
      <td>是</td>
      <td>8887704</td>
      <td>2019-12-25</td>
      <td>B13093</td>
      <td>6660.19</td>
      <td>199.81</td>
      <td>6860.0</td>
      <td>有效发票</td>
    </tr>
  </tbody>
</table>
<p>162484 rows × 11 columns</p>
</div>




```python
data1.head(5)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>信誉评级</th>
      <th>是否违约</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E2</td>
      <td>***技术有限责任公司</td>
      <td>A</td>
      <td>否</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E3</td>
      <td>***电子(中国)有限公司***分公司</td>
      <td>C</td>
      <td>否</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E4</td>
      <td>***发展有限责任公司</td>
      <td>C</td>
      <td>否</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E5</td>
      <td>***供应链管理有限公司</td>
      <td>B</td>
      <td>否</td>
    </tr>
  </tbody>
</table>
</div>




```python
a_company = data1[data1['信誉评级'] == 'A']
a_number = a_company['信誉评级'].count()
a_default = a_company[a_company['是否违约'] == '是']['信誉评级'].count()
a_default_rate = a_default/a_number
a_default_rate = round(a_default_rate, 4)
print(a_number)
print(a_default)
print(a_default_rate)
```

    27
    0
    0.0



```python
b_company = data1[data1['信誉评级'] == 'B']
b_number = b_company['信誉评级'].count()
b_default = b_company[b_company['是否违约'] == '是']['信誉评级'].count()
b_default_rate = b_default/b_number
b_default_rate = round(b_default_rate, 4)
print(b_number)
print(b_default)
print(b_default_rate)
```

    38
    1
    0.0263



```python
c_company = data1[data1['信誉评级'] == 'C']
c_number = c_company['信誉评级'].count()
c_default = c_company[c_company['是否违约'] == '是']['信誉评级'].count()
c_default_rate = c_default/c_number
c_default_rate = round(c_default_rate, 4)
print(c_number)
print(c_default)
print(c_default_rate)
```

    34
    2
    0.0588



```python
data4 = data1.copy()
data4['default_rate'] = 0
data4.loc[(data4['信誉评级']=='A'),'default_rate'] = a_default_rate
data4.loc[(data4['信誉评级']=='B'),'default_rate'] = b_default_rate
data4.loc[(data4['信誉评级']=='C'),'default_rate'] = c_default_rate
data4.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>信誉评级</th>
      <th>是否违约</th>
      <th>default_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E1</td>
      <td>***电器销售有限公司</td>
      <td>A</td>
      <td>否</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E2</td>
      <td>***技术有限责任公司</td>
      <td>A</td>
      <td>否</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E3</td>
      <td>***电子(中国)有限公司***分公司</td>
      <td>C</td>
      <td>否</td>
      <td>0.0588</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E4</td>
      <td>***发展有限责任公司</td>
      <td>C</td>
      <td>否</td>
      <td>0.0588</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E5</td>
      <td>***供应链管理有限公司</td>
      <td>B</td>
      <td>否</td>
      <td>0.0263</td>
    </tr>
  </tbody>
</table>
</div>




```python
import seaborn as sns 
import matplotlib.pyplot as plt 
def autolabel(rects):
    for rect in rects:
        height = rect.get_height()
        plt.text(rect.get_x()+rect.get_width()/2.-0.2, 1*height, '%s' % float(height))


x1=[0,1,2]

result1=[a_default_rate]
result2=[b_default_rate]
result3=[c_default_rate]

name=['skeleton']
total_width,n=0.9,3
width=total_width/n

a=plt.bar(x1[0],result1,width=width,label='A',tick_label='A',fc='y')

b=plt.bar(x1[1],result2,width=width,label='B',tick_label='B',fc='g')

c=plt.bar(x1[2],result3,width=width,label='C',tick_label='C',fc='r')
autolabel(a)
autolabel(b)
autolabel(c)

plt.xlabel('credit_rating')
plt.ylabel('default_rate')
plt.title('Default probability of users at all levels')
plt.legend()
plt.xlim(-0.5, 2.5)
plt.ylim(0.0, 0.1)
plt.xticks(x1,['A','B','C'])
plt.savefig("Default probability of users at all levels.png")
plt.show()
```


![png](output_8_0.png)



```python
#Python-生成一定范围的随机小数
import random
#小数的范围A ~ B
#随机数的精度round(数值，精度)

def _random(a, b, n) :
    # 定义一个空列表存储随机数
    a_list = []
    c = random.randint(90, n)
    sum = 0
    while ((len(a_list) < c )& (1-sum > 0.001)):
        d = random.uniform(a, b)
        round(d,4)
        if(d + sum <= 1):
            a_list.append(d)
            sum+=d
        else:
            pass
    while len(a_list) < n:
        a_list.append(0)
    
    random.shuffle(a_list)
    return a_list

random_list = _random(0.001, 0.01, 302)
print(random_list)
print(len(random_list))
```

    [0, 0, 0.009434771695886534, 0.0012496174805247623, 0, 0.0016820603709608011, 0, 0, 0, 0.006629489428524694, 0.007295601329473488, 0, 0.009166380614804973, 0.005277638549334832, 0.004317937268932065, 0.007916192786272959, 0, 0.007380329186673191, 0.00258399072581293, 0.0034072898838984744, 0.009516428341063813, 0, 0, 0.0026783476043513816, 0.0016371663220342758, 0.0036398609338490154, 0.003709130649878039, 0, 0.00859520151267859, 0, 0.007380482169231893, 0.004443235308519927, 0.0022552915487597867, 0.001905493095152731, 0.0066912981479532625, 0, 0.003280155748263657, 0, 0, 0.0019240914187643168, 0, 0, 0.0017898723346775201, 0.008029557049417883, 0.005846353073334775, 0, 0, 0.003107363259660907, 0.009576898386829586, 0.006411788016175165, 0.0058978737138311674, 0.005978068818863912, 0.0024446891725550647, 0.00386641132707429, 0.00982909464390129, 0.008249128889463601, 0.002295027289607716, 0, 0.00584920525708898, 0.005680980595354006, 0.0035805880555816304, 0, 0.0012319241470676958, 0, 0, 0.0024848393611063644, 0.005754191675256485, 0.008263204809146565, 0.006143877580414785, 0, 0.00312045166565804, 0.003985128749477654, 0, 0.0011737752071815212, 0.00895579297678463, 0.008757538261371616, 0.009313867040164202, 0.004158520331103883, 0, 0.006126782802867048, 0, 0.0021167447054523877, 0, 0, 0.007829520186818295, 0.003429500679351707, 0, 0.00980379183083202, 0, 0.002866778577969769, 0, 0.009739213259455638, 0, 0.009474001516135942, 0, 0.0019930368340752786, 0, 0.004331644587989906, 0, 0.0036729231121406113, 0.0033051736079880703, 0, 0, 0.008010207905137531, 0, 0.009594386934384278, 0.006845720625999612, 0.004538832185107929, 0.008478308585406902, 0.00743375440982448, 0.006940780417137244, 0.009762336087574031, 0.008724252068840668, 0.004846647217115942, 0, 0.007503774013206098, 0, 0.005078748865960623, 0, 0.0021696436359868554, 0.006402353083137466, 0.0030212359542058018, 0, 0, 0.003039510587476217, 0, 0, 0, 0, 0, 0.004036382462482353, 0.0015504349661919535, 0, 0.008464554601622886, 0.009510344674642582, 0, 0, 0.005541959051409276, 0.0036706115476331617, 0, 0, 0.008898742146213369, 0.0035211048741913445, 0.0019681928022924084, 0.008405442363142154, 0.009009159298312884, 0.0021385156627264255, 0, 0, 0, 0, 0, 0.008240242253163896, 0.0029759739324058095, 0.00691272368538535, 0.0010454329325771969, 0, 0, 0, 0.004494058385915518, 0, 0.006216801579007778, 0.004468021756227918, 0.0032701460317816383, 0, 0.00932717593928364, 0, 0.009083829776772988, 0, 0.0036266985339565216, 0, 0.004176286926349674, 0.008421809694011677, 0.005225688276826423, 0.0028671800461043933, 0, 0.0022410841235814575, 0.00994235945536719, 0, 0, 0, 0, 0, 0.0037039867073871374, 0, 0.006620627849128733, 0.005315947733309678, 0, 0.003154821756332977, 0.006761465595578043, 0.005744635096492757, 0.008662441974484188, 0, 0.0018637523750924829, 0.005450604356674028, 0.009016251903871692, 0, 0, 0.009621599658597307, 0.005842839169992058, 0, 0.007446529225610412, 0, 0.004611685146681864, 0.003853485736162803, 0.006849725895167293, 0, 0.007323064108939128, 0, 0.001289256666950856, 0.0068197745910047085, 0.005179975818022108, 0.007763512779771549, 0.0040858204110692815, 0.007495180279845098, 0.0021425735610219807, 0, 0, 0.007496071836754703, 0.009987746565776213, 0, 0.0016059147602651407, 0.002656742911144809, 0, 0, 0.009999032385964949, 0.008296796317019888, 0, 0, 0, 0.0011372297603807354, 0, 0, 0, 0, 0, 0, 0, 0.002821243645651087, 0.008001931705742989, 0.005399774713302103, 0.002209922722293752, 0, 0, 0.008496441567201932, 0, 0.0016312622365661322, 0.006562402707525718, 0.00644258999458908, 0.006812826384480157, 0, 0.0068975431759576615, 0.005390481720869264, 0.001005450670607808, 0.005909516079097087, 0.006263216816654012, 0.007169785899938209, 0, 0, 0, 0, 0.0026167238974939347, 0, 0, 0.004397612578299686, 0, 0.0036656887930992684, 0, 0, 0.0015773926558498978, 0.0029438214922388123, 0.0016392085273475411, 0.008892284056364587, 0, 0.005846753116367307, 0.008182196206123583, 0, 0.007729836709010494, 0.007070434297671923, 0.005356576248807204, 0.006500561205612444, 0.007085805475930157, 0, 0, 0, 0, 0.0027182408323886058, 0, 0, 0.004005347110694082, 0.001188186559391267, 0.007738128460569692, 0.008137886601645026, 0, 0.00366671354836147, 0.004868001233983657, 0.0026205827353468136, 0.009501688882373908, 0.0032225135985835683, 0.005403754611322803, 0.0023331164531799767, 0.007629800251736207]
    302



```python
data5 = pd.read_excel("D:\OneDrive\桌面\model\附件2：302家无信贷记录企业的相关数据.xlsx", sheet_name='企业信息')
data6 = pd.read_excel("D:\OneDrive\桌面\model\附件2：302家无信贷记录企业的相关数据.xlsx", sheet_name='进项发票信息')
data7 = pd.read_excel("D:\OneDrive\桌面\model\附件2：302家无信贷记录企业的相关数据.xlsx", sheet_name='销项发票信息')
income_n = pd.merge(data5,data6,on='企业代号')
expense_n = pd.merge(data5, data7, on = '企业代号')
```


```python
from datetime import datetime
income_n['开票日期'] = pd.to_datetime(income_n['开票日期'], format='%Y-%m-%d %H:%M:%S')
income_n['date']=income_n['开票日期']
income_n['date'] =income_n['date'].apply(lambda x:datetime.strftime(x,'%Y-%m'))

expense_n['开票日期'] = pd.to_datetime(expense_n['开票日期'], format='%Y-%m-%d %H:%M:%S')
expense_n['date']=expense_n['开票日期']
expense_n['date'] =expense_n['date'].apply(lambda x:datetime.strftime(x,'%Y-%m'))
```


```python
income_n
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>发票号码</th>
      <th>开票日期</th>
      <th>销方单位代号</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
      <th>发票状态</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>18891676</td>
      <td>2017-09-01 00:00:00</td>
      <td>C00014</td>
      <td>338.46</td>
      <td>57.54</td>
      <td>396.0</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>18691267</td>
      <td>2017-09-01 00:00:00</td>
      <td>C00480</td>
      <td>230.10</td>
      <td>6.90</td>
      <td>237.0</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>12995412</td>
      <td>2017-09-01 00:00:00</td>
      <td>C23675</td>
      <td>223.30</td>
      <td>6.70</td>
      <td>230.0</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>6378193</td>
      <td>2017-09-01 11:11:03</td>
      <td>C00333</td>
      <td>90090.09</td>
      <td>9909.91</td>
      <td>100000.0</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>6378194</td>
      <td>2017-09-01 11:12:01</td>
      <td>C00333</td>
      <td>90090.09</td>
      <td>9909.91</td>
      <td>100000.0</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>395170</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>72101375</td>
      <td>2019-12-30 00:00:00</td>
      <td>C23112</td>
      <td>663.11</td>
      <td>19.89</td>
      <td>683.0</td>
      <td>有效发票</td>
      <td>2019-12</td>
    </tr>
    <tr>
      <th>395171</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>20253285</td>
      <td>2020-01-05 00:00:00</td>
      <td>C01937</td>
      <td>45.41</td>
      <td>4.09</td>
      <td>49.5</td>
      <td>有效发票</td>
      <td>2020-01</td>
    </tr>
    <tr>
      <th>395172</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>20253315</td>
      <td>2020-01-05 00:00:00</td>
      <td>C01937</td>
      <td>110.14</td>
      <td>1.16</td>
      <td>111.3</td>
      <td>有效发票</td>
      <td>2020-01</td>
    </tr>
    <tr>
      <th>395173</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>52449404</td>
      <td>2020-01-06 00:00:00</td>
      <td>C15032</td>
      <td>73.22</td>
      <td>6.58</td>
      <td>79.8</td>
      <td>有效发票</td>
      <td>2020-01</td>
    </tr>
    <tr>
      <th>395174</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>5666299</td>
      <td>2020-01-10 00:00:00</td>
      <td>C23112</td>
      <td>132.04</td>
      <td>3.96</td>
      <td>136.0</td>
      <td>有效发票</td>
      <td>2020-01</td>
    </tr>
  </tbody>
</table>
<p>395175 rows × 10 columns</p>
</div>




```python
expense_n
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>企业名称</th>
      <th>发票号码</th>
      <th>开票日期</th>
      <th>购方单位代号</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
      <th>发票状态</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>15212483</td>
      <td>2017-09-01 11:58:43</td>
      <td>D00585</td>
      <td>839350.55</td>
      <td>92328.56</td>
      <td>931679.11</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>15212484</td>
      <td>2017-09-01 11:59:20</td>
      <td>D00585</td>
      <td>900900.90</td>
      <td>99099.10</td>
      <td>1000000.00</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>15212485</td>
      <td>2017-09-01 11:59:51</td>
      <td>D00585</td>
      <td>900900.90</td>
      <td>99099.10</td>
      <td>1000000.00</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>15212486</td>
      <td>2017-09-01 12:00:45</td>
      <td>D00585</td>
      <td>697365.74</td>
      <td>76710.23</td>
      <td>774075.97</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E124</td>
      <td>个体经营E124</td>
      <td>6089615</td>
      <td>2017-09-05 10:58:38</td>
      <td>D00108</td>
      <td>726216.22</td>
      <td>79883.78</td>
      <td>806100.00</td>
      <td>有效发票</td>
      <td>2017-09</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>330830</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>21803468</td>
      <td>2018-04-03 00:00:00</td>
      <td>D21446</td>
      <td>9000.00</td>
      <td>270.00</td>
      <td>9270.00</td>
      <td>有效发票</td>
      <td>2018-04</td>
    </tr>
    <tr>
      <th>330831</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>21803469</td>
      <td>2018-04-03 00:00:00</td>
      <td>D21446</td>
      <td>5155.34</td>
      <td>154.66</td>
      <td>5310.00</td>
      <td>有效发票</td>
      <td>2018-04</td>
    </tr>
    <tr>
      <th>330832</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>21803470</td>
      <td>2019-06-11 00:00:00</td>
      <td>D02126</td>
      <td>4854.37</td>
      <td>145.63</td>
      <td>5000.00</td>
      <td>作废发票</td>
      <td>2019-06</td>
    </tr>
    <tr>
      <th>330833</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>21803471</td>
      <td>2019-06-11 00:00:00</td>
      <td>D02126</td>
      <td>4854.37</td>
      <td>145.63</td>
      <td>5000.00</td>
      <td>作废发票</td>
      <td>2019-06</td>
    </tr>
    <tr>
      <th>330834</th>
      <td>E425</td>
      <td>***商贸有限公司</td>
      <td>21803472</td>
      <td>2019-06-11 00:00:00</td>
      <td>D02126</td>
      <td>4854.37</td>
      <td>145.63</td>
      <td>5000.00</td>
      <td>有效发票</td>
      <td>2019-06</td>
    </tr>
  </tbody>
</table>
<p>330835 rows × 10 columns</p>
</div>




```python
data5['企业代号'].tolist()
efficiency = (0.039571+0.039924+0.039277)/3
print(efficiency)
```

    0.03959066666666667



```python
company_out = income_n[income_n['发票状态'] == '有效发票'].groupby(['企业代号','date']).sum().reset_index()
company_out = company_out.set_index("date")
company_in = expense_n[expense_n['发票状态'] == '有效发票'].groupby(['企业代号','date']).sum().reset_index()
company_in = company_in.set_index("date")
```


```python
company_out
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>发票号码</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>E124</td>
      <td>3092361832</td>
      <td>15961026.34</td>
      <td>1097205.79</td>
      <td>17058232.13</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>E124</td>
      <td>2774006318</td>
      <td>10741042.73</td>
      <td>897149.66</td>
      <td>11638192.39</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>E124</td>
      <td>4083387959</td>
      <td>14512592.99</td>
      <td>1120696.10</td>
      <td>15633289.09</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>E124</td>
      <td>5013643203</td>
      <td>21876265.20</td>
      <td>1806385.95</td>
      <td>23682651.15</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>E124</td>
      <td>4981678199</td>
      <td>37188599.69</td>
      <td>2480415.64</td>
      <td>39669015.33</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>E425</td>
      <td>24468933</td>
      <td>1354.31</td>
      <td>50.09</td>
      <td>1404.40</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>E425</td>
      <td>270687790</td>
      <td>4238.79</td>
      <td>256.16</td>
      <td>4494.95</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>E425</td>
      <td>333866460</td>
      <td>4271.70</td>
      <td>217.16</td>
      <td>4488.86</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>E425</td>
      <td>108789873</td>
      <td>1065.74</td>
      <td>70.29</td>
      <td>1136.03</td>
    </tr>
    <tr>
      <th>2020-01</th>
      <td>E425</td>
      <td>98622303</td>
      <td>360.81</td>
      <td>15.79</td>
      <td>376.60</td>
    </tr>
  </tbody>
</table>
<p>8612 rows × 5 columns</p>
</div>




```python
company_in
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>发票号码</th>
      <th>金额</th>
      <th>税额</th>
      <th>价税合计</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>E124</td>
      <td>452525272</td>
      <td>14590753.09</td>
      <td>725181.90</td>
      <td>15315934.99</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>E124</td>
      <td>243931657</td>
      <td>14873606.03</td>
      <td>1615525.25</td>
      <td>16489131.28</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>E124</td>
      <td>105426916</td>
      <td>18023810.32</td>
      <td>1508828.80</td>
      <td>19532639.12</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>E124</td>
      <td>409701799</td>
      <td>39675314.43</td>
      <td>2641007.09</td>
      <td>42316321.52</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>E124</td>
      <td>357393996</td>
      <td>21356615.76</td>
      <td>2043208.37</td>
      <td>23399824.13</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>E424</td>
      <td>85100813</td>
      <td>555.34</td>
      <td>16.66</td>
      <td>572.00</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>E424</td>
      <td>85100817</td>
      <td>2536.00</td>
      <td>76.08</td>
      <td>2612.08</td>
    </tr>
    <tr>
      <th>2018-03</th>
      <td>E425</td>
      <td>109017315</td>
      <td>48116.50</td>
      <td>1443.50</td>
      <td>49560.00</td>
    </tr>
    <tr>
      <th>2018-04</th>
      <td>E425</td>
      <td>87213870</td>
      <td>32155.34</td>
      <td>964.66</td>
      <td>33120.00</td>
    </tr>
    <tr>
      <th>2019-06</th>
      <td>E425</td>
      <td>21803472</td>
      <td>4854.37</td>
      <td>145.63</td>
      <td>5000.00</td>
    </tr>
  </tbody>
</table>
<p>8410 rows × 5 columns</p>
</div>




```python
company_data_t = pd.merge(company_in, company_out, how='outer', on=['企业代号','date']) #company_in[company_in['企业代号'] == 'E124']# - company_out[company_out['企业代号'] == 'E124']
company_data_t = company_data_t.fillna(0)
company_data_t['profit'] = company_data_t['价税合计_y'] - company_data_t['价税合计_x']
company_data_t
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>发票号码_x</th>
      <th>金额_x</th>
      <th>税额_x</th>
      <th>价税合计_x</th>
      <th>发票号码_y</th>
      <th>金额_y</th>
      <th>税额_y</th>
      <th>价税合计_y</th>
      <th>profit</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>E124</td>
      <td>452525272.0</td>
      <td>14590753.09</td>
      <td>725181.90</td>
      <td>15315934.99</td>
      <td>3.092362e+09</td>
      <td>15961026.34</td>
      <td>1097205.79</td>
      <td>17058232.13</td>
      <td>1742297.14</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>E124</td>
      <td>243931657.0</td>
      <td>14873606.03</td>
      <td>1615525.25</td>
      <td>16489131.28</td>
      <td>2.774006e+09</td>
      <td>10741042.73</td>
      <td>897149.66</td>
      <td>11638192.39</td>
      <td>-4850938.89</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>E124</td>
      <td>105426916.0</td>
      <td>18023810.32</td>
      <td>1508828.80</td>
      <td>19532639.12</td>
      <td>4.083388e+09</td>
      <td>14512592.99</td>
      <td>1120696.10</td>
      <td>15633289.09</td>
      <td>-3899350.03</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>E124</td>
      <td>409701799.0</td>
      <td>39675314.43</td>
      <td>2641007.09</td>
      <td>42316321.52</td>
      <td>5.013643e+09</td>
      <td>21876265.20</td>
      <td>1806385.95</td>
      <td>23682651.15</td>
      <td>-18633670.37</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>E124</td>
      <td>357393996.0</td>
      <td>21356615.76</td>
      <td>2043208.37</td>
      <td>23399824.13</td>
      <td>4.981678e+09</td>
      <td>37188599.69</td>
      <td>2480415.64</td>
      <td>39669015.33</td>
      <td>16269191.20</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>E425</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>2.446893e+07</td>
      <td>1354.31</td>
      <td>50.09</td>
      <td>1404.40</td>
      <td>1404.40</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>E425</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>2.706878e+08</td>
      <td>4238.79</td>
      <td>256.16</td>
      <td>4494.95</td>
      <td>4494.95</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>E425</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>3.338665e+08</td>
      <td>4271.70</td>
      <td>217.16</td>
      <td>4488.86</td>
      <td>4488.86</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>E425</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1.087899e+08</td>
      <td>1065.74</td>
      <td>70.29</td>
      <td>1136.03</td>
      <td>1136.03</td>
    </tr>
    <tr>
      <th>2020-01</th>
      <td>E425</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>9.862230e+07</td>
      <td>360.81</td>
      <td>15.79</td>
      <td>376.60</td>
      <td>376.60</td>
    </tr>
  </tbody>
</table>
<p>9728 rows × 10 columns</p>
</div>




```python
company_data = company_data_t.reset_index()[['date', '企业代号', 'profit']]
company_data = company_data.set_index("date")
company_data["profit_sum"] = company_data["profit"].cumsum(axis=0)
company_data["profit_sum"] = company_data["profit_sum"]*efficiency
company_data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>profit</th>
      <th>profit_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>E124</td>
      <td>1742297.14</td>
      <td>6.897871e+04</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>E124</td>
      <td>-4850938.89</td>
      <td>-1.230732e+05</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>E124</td>
      <td>-3899350.03</td>
      <td>-2.774511e+05</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>E124</td>
      <td>-18633670.37</td>
      <td>-1.015170e+06</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>E124</td>
      <td>16269191.20</td>
      <td>-3.710624e+05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>E425</td>
      <td>1404.40</td>
      <td>-2.890355e+08</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>E425</td>
      <td>4494.95</td>
      <td>-2.890354e+08</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>E425</td>
      <td>4488.86</td>
      <td>-2.890352e+08</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>E425</td>
      <td>1136.03</td>
      <td>-2.890351e+08</td>
    </tr>
    <tr>
      <th>2020-01</th>
      <td>E425</td>
      <td>376.60</td>
      <td>-2.890351e+08</td>
    </tr>
  </tbody>
</table>
<p>9728 rows × 3 columns</p>
</div>




```python
company_profit = company_data[company_data['企业代号'] == 'E124']
company_profit
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>企业代号</th>
      <th>profit</th>
      <th>profit_sum</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>E124</td>
      <td>1742297.14</td>
      <td>6.897871e+04</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>E124</td>
      <td>-4850938.89</td>
      <td>-1.230732e+05</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>E124</td>
      <td>-3899350.03</td>
      <td>-2.774511e+05</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>E124</td>
      <td>-18633670.37</td>
      <td>-1.015170e+06</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>E124</td>
      <td>16269191.20</td>
      <td>-3.710624e+05</td>
    </tr>
    <tr>
      <th>2018-02</th>
      <td>E124</td>
      <td>-6461036.58</td>
      <td>-6.268591e+05</td>
    </tr>
    <tr>
      <th>2018-03</th>
      <td>E124</td>
      <td>1605036.55</td>
      <td>-5.633147e+05</td>
    </tr>
    <tr>
      <th>2018-04</th>
      <td>E124</td>
      <td>9914905.24</td>
      <td>-1.707769e+05</td>
    </tr>
    <tr>
      <th>2018-05</th>
      <td>E124</td>
      <td>-11079320.32</td>
      <td>-6.094146e+05</td>
    </tr>
    <tr>
      <th>2018-06</th>
      <td>E124</td>
      <td>9828753.31</td>
      <td>-2.202877e+05</td>
    </tr>
    <tr>
      <th>2018-07</th>
      <td>E124</td>
      <td>6771729.45</td>
      <td>4.780956e+04</td>
    </tr>
    <tr>
      <th>2018-08</th>
      <td>E124</td>
      <td>4766864.59</td>
      <td>2.365329e+05</td>
    </tr>
    <tr>
      <th>2018-09</th>
      <td>E124</td>
      <td>5739876.20</td>
      <td>4.637784e+05</td>
    </tr>
    <tr>
      <th>2018-10</th>
      <td>E124</td>
      <td>-5034003.15</td>
      <td>2.644789e+05</td>
    </tr>
    <tr>
      <th>2018-11</th>
      <td>E124</td>
      <td>11603449.49</td>
      <td>7.238672e+05</td>
    </tr>
    <tr>
      <th>2018-12</th>
      <td>E124</td>
      <td>418682.21</td>
      <td>7.404431e+05</td>
    </tr>
    <tr>
      <th>2019-01</th>
      <td>E124</td>
      <td>-8633530.07</td>
      <td>3.986359e+05</td>
    </tr>
    <tr>
      <th>2019-02</th>
      <td>E124</td>
      <td>-9886925.00</td>
      <td>7.205936e+03</td>
    </tr>
    <tr>
      <th>2019-03</th>
      <td>E124</td>
      <td>7873770.88</td>
      <td>3.189338e+05</td>
    </tr>
    <tr>
      <th>2019-04</th>
      <td>E124</td>
      <td>2156662.89</td>
      <td>4.043175e+05</td>
    </tr>
    <tr>
      <th>2019-05</th>
      <td>E124</td>
      <td>15418112.76</td>
      <td>1.014731e+06</td>
    </tr>
    <tr>
      <th>2019-06</th>
      <td>E124</td>
      <td>-3281984.19</td>
      <td>8.847949e+05</td>
    </tr>
    <tr>
      <th>2019-07</th>
      <td>E124</td>
      <td>10194047.45</td>
      <td>1.288384e+06</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>E124</td>
      <td>5825682.82</td>
      <td>1.519027e+06</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>E124</td>
      <td>-2603254.52</td>
      <td>1.415962e+06</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 创建空的DataFrame变量，用于存储公司数据
CompanyProfit = pd.DataFrame()

#profit_value_list=[]  #存储每个公司的平均市值

# 创建公司代号的列表
company_list = data5['企业代号'].tolist()
# 使用循环，挨个获取每只股票的数据，并存储每日收盘价
for company in company_list:
    company_profit = company_data[company_data['企业代号'] == company]
    
    CompanyProfit[company] = company_profit['profit_sum']  #获取每个公司的利润
    #将每个公司的利润存入列表中
    #profit_value_list.append(stock_data['市值'].mean())

CompanyProfit.index.name = 'date'  #日期为索引列
# 输出数据的前5行
for column in list(CompanyProfit.columns[CompanyProfit.isnull().sum() > 0]):
    mean_val = CompanyProfit[column].mean()
    CompanyProfit[column].fillna(mean_val, inplace=True)

CompanyProfit
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>E124</th>
      <th>E125</th>
      <th>E126</th>
      <th>E127</th>
      <th>E128</th>
      <th>E129</th>
      <th>E130</th>
      <th>E131</th>
      <th>E132</th>
      <th>E133</th>
      <th>...</th>
      <th>E416</th>
      <th>E417</th>
      <th>E418</th>
      <th>E419</th>
      <th>E420</th>
      <th>E421</th>
      <th>E422</th>
      <th>E423</th>
      <th>E424</th>
      <th>E425</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>6.897871e+04</td>
      <td>-2.037270e+05</td>
      <td>-9.262178e+05</td>
      <td>-2.235691e+07</td>
      <td>-4.396025e+07</td>
      <td>-5.394446e+07</td>
      <td>-6.327799e+07</td>
      <td>-6.629389e+07</td>
      <td>-7.075132e+07</td>
      <td>-3.060910e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894577e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.894394e+08</td>
      <td>-3.062435e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890414e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>-1.230732e+05</td>
      <td>-3.996141e+05</td>
      <td>-1.240618e+06</td>
      <td>-2.274337e+07</td>
      <td>-4.396377e+07</td>
      <td>-5.443668e+07</td>
      <td>-6.327748e+07</td>
      <td>-6.639338e+07</td>
      <td>-7.086202e+07</td>
      <td>-3.060714e+08</td>
      <td>...</td>
      <td>-3.062945e+08</td>
      <td>-2.894577e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.894391e+08</td>
      <td>-3.062416e+08</td>
      <td>-2.890431e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>-2.774511e+05</td>
      <td>-5.605839e+05</td>
      <td>-1.921767e+06</td>
      <td>-2.317442e+07</td>
      <td>-4.398158e+07</td>
      <td>-5.532893e+07</td>
      <td>-6.327677e+07</td>
      <td>-6.654515e+07</td>
      <td>-7.101132e+07</td>
      <td>-3.060493e+08</td>
      <td>...</td>
      <td>-3.062957e+08</td>
      <td>-2.922644e+08</td>
      <td>-2.894560e+08</td>
      <td>-2.894332e+08</td>
      <td>-3.062378e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890410e+08</td>
      <td>-3.061939e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>-1.015170e+06</td>
      <td>-1.338258e+06</td>
      <td>-2.689980e+06</td>
      <td>-2.568782e+07</td>
      <td>-4.396715e+07</td>
      <td>-5.589342e+07</td>
      <td>-6.328509e+07</td>
      <td>-6.646776e+07</td>
      <td>-7.119919e+07</td>
      <td>-3.058631e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-3.062999e+08</td>
      <td>-2.894560e+08</td>
      <td>-2.894311e+08</td>
      <td>-3.062371e+08</td>
      <td>-3.061827e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890407e+08</td>
      <td>-3.061940e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>-3.710624e+05</td>
      <td>-7.111556e+05</td>
      <td>-3.324496e+06</td>
      <td>-2.696701e+07</td>
      <td>-4.427490e+07</td>
      <td>-5.622106e+07</td>
      <td>-3.061661e+08</td>
      <td>-6.672585e+07</td>
      <td>-7.155686e+07</td>
      <td>-7.708433e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894577e+08</td>
      <td>-3.063132e+08</td>
      <td>-2.894290e+08</td>
      <td>-3.062330e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061940e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2018-02</th>
      <td>-6.268591e+05</td>
      <td>-1.001561e+06</td>
      <td>-3.389722e+06</td>
      <td>-2.768106e+07</td>
      <td>-4.457424e+07</td>
      <td>-5.632171e+07</td>
      <td>-3.061648e+08</td>
      <td>-6.676220e+07</td>
      <td>-7.170856e+07</td>
      <td>-3.057711e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894576e+08</td>
      <td>-2.894555e+08</td>
      <td>-2.894269e+08</td>
      <td>-3.062293e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.890368e+08</td>
    </tr>
    <tr>
      <th>2018-03</th>
      <td>-5.633147e+05</td>
      <td>-9.392913e+05</td>
      <td>-3.700160e+06</td>
      <td>-2.829129e+07</td>
      <td>-4.456826e+07</td>
      <td>-5.669055e+07</td>
      <td>-3.061672e+08</td>
      <td>-6.685869e+07</td>
      <td>-7.170345e+07</td>
      <td>-3.057495e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894575e+08</td>
      <td>-3.063140e+08</td>
      <td>-2.894232e+08</td>
      <td>-3.062293e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-3.061930e+08</td>
      <td>-3.061949e+08</td>
      <td>-3.061907e+08</td>
    </tr>
    <tr>
      <th>2018-04</th>
      <td>-1.707769e+05</td>
      <td>-5.510550e+05</td>
      <td>-3.797984e+06</td>
      <td>-2.872404e+07</td>
      <td>-4.520731e+07</td>
      <td>-5.716261e+07</td>
      <td>-3.061664e+08</td>
      <td>-6.696129e+07</td>
      <td>-7.178135e+07</td>
      <td>-3.057000e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894575e+08</td>
      <td>-2.894549e+08</td>
      <td>-2.894217e+08</td>
      <td>-3.062253e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890402e+08</td>
      <td>-2.890382e+08</td>
      <td>-3.061914e+08</td>
    </tr>
    <tr>
      <th>2018-05</th>
      <td>-6.094146e+05</td>
      <td>-1.009393e+06</td>
      <td>-4.220466e+06</td>
      <td>-2.990972e+07</td>
      <td>-4.574667e+07</td>
      <td>-5.752869e+07</td>
      <td>-3.061615e+08</td>
      <td>-6.711061e+07</td>
      <td>-7.189672e+07</td>
      <td>-7.709515e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894575e+08</td>
      <td>-3.063152e+08</td>
      <td>-3.063079e+08</td>
      <td>-3.062236e+08</td>
      <td>-2.890431e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890402e+08</td>
      <td>-3.061949e+08</td>
      <td>-2.890367e+08</td>
    </tr>
    <tr>
      <th>2018-06</th>
      <td>-2.202877e+05</td>
      <td>-7.084071e+05</td>
      <td>-4.726097e+06</td>
      <td>-3.009353e+07</td>
      <td>-4.587399e+07</td>
      <td>-5.775788e+07</td>
      <td>-3.061604e+08</td>
      <td>-6.726444e+07</td>
      <td>-7.218254e+07</td>
      <td>-3.056901e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894573e+08</td>
      <td>-2.894548e+08</td>
      <td>-2.894097e+08</td>
      <td>-3.062203e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.061899e+08</td>
      <td>-3.061934e+08</td>
      <td>-3.061946e+08</td>
      <td>-2.890365e+08</td>
    </tr>
    <tr>
      <th>2018-07</th>
      <td>4.780956e+04</td>
      <td>-5.396995e+05</td>
      <td>-5.066900e+06</td>
      <td>-3.121565e+07</td>
      <td>-4.587229e+07</td>
      <td>-5.800478e+07</td>
      <td>-3.061586e+08</td>
      <td>-6.740268e+07</td>
      <td>-7.252618e+07</td>
      <td>-3.056858e+08</td>
      <td>...</td>
      <td>-2.894616e+08</td>
      <td>-3.063006e+08</td>
      <td>-3.063159e+08</td>
      <td>-2.893917e+08</td>
      <td>-3.062183e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890401e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.890364e+08</td>
    </tr>
    <tr>
      <th>2018-08</th>
      <td>2.365329e+05</td>
      <td>-4.067185e+05</td>
      <td>-5.404228e+06</td>
      <td>-3.173065e+07</td>
      <td>-4.607534e+07</td>
      <td>-5.836449e+07</td>
      <td>-6.328150e+07</td>
      <td>-6.756025e+07</td>
      <td>-7.271061e+07</td>
      <td>-3.056709e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894572e+08</td>
      <td>-2.894548e+08</td>
      <td>-2.893808e+08</td>
      <td>-3.062161e+08</td>
      <td>-2.890431e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.890363e+08</td>
    </tr>
    <tr>
      <th>2018-09</th>
      <td>4.637784e+05</td>
      <td>-1.812419e+05</td>
      <td>-5.903335e+06</td>
      <td>-3.289371e+07</td>
      <td>-4.606220e+07</td>
      <td>-5.882789e+07</td>
      <td>-6.327925e+07</td>
      <td>-6.771854e+07</td>
      <td>-7.296169e+07</td>
      <td>-7.708551e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-3.063009e+08</td>
      <td>-3.063159e+08</td>
      <td>-2.893669e+08</td>
      <td>-3.062143e+08</td>
      <td>-3.061889e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.890400e+08</td>
      <td>-2.890379e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2018-10</th>
      <td>2.644789e+05</td>
      <td>-3.866828e+05</td>
      <td>-6.317990e+06</td>
      <td>-3.328779e+07</td>
      <td>-4.617163e+07</td>
      <td>-5.913744e+07</td>
      <td>-6.328175e+07</td>
      <td>-6.792372e+07</td>
      <td>-7.325096e+07</td>
      <td>-3.055549e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894572e+08</td>
      <td>-3.063162e+08</td>
      <td>-2.893518e+08</td>
      <td>-3.062109e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.061899e+08</td>
      <td>-2.890400e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2018-11</th>
      <td>7.238672e+05</td>
      <td>6.515446e+04</td>
      <td>-7.026272e+06</td>
      <td>-3.374996e+07</td>
      <td>-4.626803e+07</td>
      <td>-5.953049e+07</td>
      <td>-6.336434e+07</td>
      <td>-6.819471e+07</td>
      <td>-7.334668e+07</td>
      <td>-7.701281e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894571e+08</td>
      <td>-3.063167e+08</td>
      <td>-2.893336e+08</td>
      <td>-3.062084e+08</td>
      <td>-3.061890e+08</td>
      <td>-3.061900e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061946e+08</td>
      <td>-2.920635e+08</td>
    </tr>
    <tr>
      <th>2018-12</th>
      <td>7.404431e+05</td>
      <td>5.498484e+04</td>
      <td>-7.925464e+06</td>
      <td>-3.563360e+07</td>
      <td>-4.678605e+07</td>
      <td>-6.003911e+07</td>
      <td>-6.331582e+07</td>
      <td>-6.784170e+07</td>
      <td>-7.353708e+07</td>
      <td>-7.696332e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894570e+08</td>
      <td>-3.063171e+08</td>
      <td>-2.893175e+08</td>
      <td>-3.062066e+08</td>
      <td>-2.890428e+08</td>
      <td>-3.061900e+08</td>
      <td>-3.061937e+08</td>
      <td>-3.061947e+08</td>
      <td>-2.890362e+08</td>
    </tr>
    <tr>
      <th>2019-01</th>
      <td>3.986359e+05</td>
      <td>-3.665528e+05</td>
      <td>-8.849580e+06</td>
      <td>-3.796144e+07</td>
      <td>-4.837184e+07</td>
      <td>-6.089454e+07</td>
      <td>-6.363529e+07</td>
      <td>-6.798900e+07</td>
      <td>-7.419437e+07</td>
      <td>-7.733475e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894569e+08</td>
      <td>-2.894548e+08</td>
      <td>-2.892882e+08</td>
      <td>-2.890468e+08</td>
      <td>-2.890427e+08</td>
      <td>-3.061900e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061920e+08</td>
      <td>-2.890361e+08</td>
    </tr>
    <tr>
      <th>2019-02</th>
      <td>7.205936e+03</td>
      <td>-7.645141e+05</td>
      <td>-8.846317e+06</td>
      <td>-3.824928e+07</td>
      <td>-3.061849e+08</td>
      <td>-6.089788e+07</td>
      <td>-6.373089e+07</td>
      <td>-6.807676e+07</td>
      <td>-7.404983e+07</td>
      <td>-7.732234e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894568e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.892747e+08</td>
      <td>-3.062052e+08</td>
      <td>-2.890425e+08</td>
      <td>-3.061900e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061900e+08</td>
      <td>-2.890361e+08</td>
    </tr>
    <tr>
      <th>2019-03</th>
      <td>3.189338e+05</td>
      <td>-4.673053e+05</td>
      <td>-9.486106e+06</td>
      <td>-3.842498e+07</td>
      <td>-3.061782e+08</td>
      <td>-6.126185e+07</td>
      <td>-3.061232e+08</td>
      <td>-6.813050e+07</td>
      <td>-7.411522e+07</td>
      <td>-7.740448e+07</td>
      <td>...</td>
      <td>-2.894616e+08</td>
      <td>-2.894567e+08</td>
      <td>-2.894548e+08</td>
      <td>-2.892602e+08</td>
      <td>-3.062025e+08</td>
      <td>-2.890423e+08</td>
      <td>-2.890421e+08</td>
      <td>-2.929987e+08</td>
      <td>-2.890378e+08</td>
      <td>-2.890360e+08</td>
    </tr>
    <tr>
      <th>2019-04</th>
      <td>4.043175e+05</td>
      <td>-3.967131e+05</td>
      <td>-1.022430e+07</td>
      <td>-3.895110e+07</td>
      <td>-4.847896e+07</td>
      <td>-6.151479e+07</td>
      <td>-6.376836e+07</td>
      <td>-6.852643e+07</td>
      <td>-7.411666e+07</td>
      <td>-7.821316e+07</td>
      <td>...</td>
      <td>-2.894616e+08</td>
      <td>-3.063024e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.892450e+08</td>
      <td>-3.062003e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.061902e+08</td>
      <td>-2.890399e+08</td>
      <td>-2.890376e+08</td>
      <td>-2.890360e+08</td>
    </tr>
    <tr>
      <th>2019-05</th>
      <td>1.014731e+06</td>
      <td>1.655922e+05</td>
      <td>-1.031934e+07</td>
      <td>-3.942617e+07</td>
      <td>-5.002165e+07</td>
      <td>-6.169052e+07</td>
      <td>-6.388310e+07</td>
      <td>-6.856794e+07</td>
      <td>-7.415502e+07</td>
      <td>-7.867893e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894567e+08</td>
      <td>-2.894547e+08</td>
      <td>-2.892266e+08</td>
      <td>-3.061984e+08</td>
      <td>-2.890422e+08</td>
      <td>-3.061902e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061900e+08</td>
      <td>-2.890359e+08</td>
    </tr>
    <tr>
      <th>2019-06</th>
      <td>8.847949e+05</td>
      <td>-2.240193e+04</td>
      <td>-1.135557e+07</td>
      <td>-3.984121e+07</td>
      <td>-5.059678e+07</td>
      <td>-6.186347e+07</td>
      <td>-6.400059e+07</td>
      <td>-6.864112e+07</td>
      <td>-7.444639e+07</td>
      <td>-7.884832e+07</td>
      <td>...</td>
      <td>-2.894616e+08</td>
      <td>-2.894566e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.892080e+08</td>
      <td>-3.061965e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.061903e+08</td>
      <td>-2.890394e+08</td>
      <td>-2.890368e+08</td>
      <td>-3.061915e+08</td>
    </tr>
    <tr>
      <th>2019-07</th>
      <td>1.288384e+06</td>
      <td>3.200469e+05</td>
      <td>-1.214624e+07</td>
      <td>-4.006142e+07</td>
      <td>-5.083278e+07</td>
      <td>-6.238895e+07</td>
      <td>-6.465404e+07</td>
      <td>-6.873363e+07</td>
      <td>-7.469174e+07</td>
      <td>-7.908291e+07</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894565e+08</td>
      <td>-2.973894e+08</td>
      <td>-3.062935e+08</td>
      <td>-3.061909e+08</td>
      <td>-2.943180e+08</td>
      <td>-3.061903e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.890357e+08</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>1.519027e+06</td>
      <td>5.130896e+05</td>
      <td>-1.290209e+07</td>
      <td>-4.047844e+07</td>
      <td>-5.141577e+07</td>
      <td>-6.256182e+07</td>
      <td>-6.468765e+07</td>
      <td>-6.880672e+07</td>
      <td>-7.489894e+07</td>
      <td>-3.055494e+08</td>
      <td>...</td>
      <td>-2.966759e+08</td>
      <td>-2.894564e+08</td>
      <td>-2.973894e+08</td>
      <td>-3.062744e+08</td>
      <td>-3.061887e+08</td>
      <td>-3.061899e+08</td>
      <td>-3.061904e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.061894e+08</td>
      <td>-2.890356e+08</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>1.415962e+06</td>
      <td>7.482705e+05</td>
      <td>-1.313984e+07</td>
      <td>-4.079869e+07</td>
      <td>-3.061704e+08</td>
      <td>-6.270866e+07</td>
      <td>-6.488582e+07</td>
      <td>-6.892310e+07</td>
      <td>-7.489204e+07</td>
      <td>-7.917914e+07</td>
      <td>...</td>
      <td>-3.062948e+08</td>
      <td>-2.894564e+08</td>
      <td>-2.973894e+08</td>
      <td>-2.891645e+08</td>
      <td>-3.055010e+08</td>
      <td>-2.890421e+08</td>
      <td>-3.047611e+08</td>
      <td>-2.929987e+08</td>
      <td>-3.011474e+08</td>
      <td>-2.890355e+08</td>
    </tr>
  </tbody>
</table>
<p>25 rows × 302 columns</p>
</div>




```python
CompanyReturns = CompanyProfit.pct_change().fillna(0)

company_return = CompanyReturns.copy()

CompanyReturns
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>E124</th>
      <th>E125</th>
      <th>E126</th>
      <th>E127</th>
      <th>E128</th>
      <th>E129</th>
      <th>E130</th>
      <th>E131</th>
      <th>E132</th>
      <th>E133</th>
      <th>...</th>
      <th>E416</th>
      <th>E417</th>
      <th>E418</th>
      <th>E419</th>
      <th>E420</th>
      <th>E421</th>
      <th>E422</th>
      <th>E423</th>
      <th>E424</th>
      <th>E425</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-09</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2017-10</th>
      <td>-2.784220</td>
      <td>0.961517</td>
      <td>0.339445</td>
      <td>0.017286</td>
      <td>0.000080</td>
      <td>0.009125</td>
      <td>-0.000008</td>
      <td>0.001501</td>
      <td>0.001565</td>
      <td>-0.000064</td>
      <td>...</td>
      <td>3.242127e-02</td>
      <td>-5.744562e-08</td>
      <td>0.000000e+00</td>
      <td>-0.000001</td>
      <td>-6.284934e-06</td>
      <td>-1.792252e-02</td>
      <td>0.000000e+00</td>
      <td>1.369098e-02</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2017-11</th>
      <td>1.254358</td>
      <td>0.402813</td>
      <td>0.549041</td>
      <td>0.018953</td>
      <td>0.000405</td>
      <td>0.016391</td>
      <td>-0.000011</td>
      <td>0.002286</td>
      <td>0.002107</td>
      <td>-0.000072</td>
      <td>...</td>
      <td>3.877706e-06</td>
      <td>9.696398e-03</td>
      <td>-2.667691e-02</td>
      <td>-0.000021</td>
      <td>-1.228216e-05</td>
      <td>1.824960e-02</td>
      <td>0.000000e+00</td>
      <td>-1.350760e-02</td>
      <td>1.675779e-02</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2017-12</th>
      <td>2.658917</td>
      <td>1.387257</td>
      <td>0.399743</td>
      <td>0.108456</td>
      <td>-0.000328</td>
      <td>0.010202</td>
      <td>0.000132</td>
      <td>-0.001163</td>
      <td>0.002645</td>
      <td>-0.000608</td>
      <td>...</td>
      <td>-3.140690e-02</td>
      <td>4.802326e-02</td>
      <td>-1.213204e-07</td>
      <td>-0.000007</td>
      <td>-2.537205e-06</td>
      <td>4.031249e-02</td>
      <td>0.000000e+00</td>
      <td>-1.079275e-06</td>
      <td>2.769927e-07</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2018-01</th>
      <td>-0.634483</td>
      <td>-0.468596</td>
      <td>0.235881</td>
      <td>0.049798</td>
      <td>0.007000</td>
      <td>0.005862</td>
      <td>3.837888</td>
      <td>0.003883</td>
      <td>0.005024</td>
      <td>-0.747978</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-5.498614e-02</td>
      <td>5.823773e-02</td>
      <td>-0.000007</td>
      <td>-1.316139e-05</td>
      <td>-3.875036e-02</td>
      <td>0.000000e+00</td>
      <td>1.369365e-02</td>
      <td>4.741146e-08</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2018-02</th>
      <td>0.689363</td>
      <td>0.408357</td>
      <td>0.019620</td>
      <td>0.026479</td>
      <td>0.006761</td>
      <td>0.001790</td>
      <td>-0.000004</td>
      <td>0.000545</td>
      <td>0.002120</td>
      <td>2.966709</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-2.318342e-07</td>
      <td>-5.503433e-02</td>
      <td>-0.000007</td>
      <td>-1.219027e-05</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>-1.648191e-02</td>
      <td>-1.036317e-02</td>
    </tr>
    <tr>
      <th>2018-03</th>
      <td>-0.101370</td>
      <td>-0.062173</td>
      <td>0.091582</td>
      <td>0.022045</td>
      <td>-0.000134</td>
      <td>0.006549</td>
      <td>0.000008</td>
      <td>0.001445</td>
      <td>-0.000071</td>
      <td>-0.000071</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-1.422464e-07</td>
      <td>5.824231e-02</td>
      <td>-0.000013</td>
      <td>-1.079344e-07</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.503186e-02</td>
      <td>1.676092e-02</td>
      <td>5.934848e-02</td>
    </tr>
    <tr>
      <th>2018-04</th>
      <td>-0.696836</td>
      <td>-0.413329</td>
      <td>0.026438</td>
      <td>0.015296</td>
      <td>0.014339</td>
      <td>0.008327</td>
      <td>-0.000003</td>
      <td>0.001535</td>
      <td>0.001086</td>
      <td>-0.000162</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-1.162591e-07</td>
      <td>-5.503889e-02</td>
      <td>-0.000005</td>
      <td>-1.289263e-05</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>-5.601944e-02</td>
      <td>-5.603179e-02</td>
      <td>2.230566e-06</td>
    </tr>
    <tr>
      <th>2018-05</th>
      <td>2.568483</td>
      <td>0.831747</td>
      <td>0.111238</td>
      <td>0.041278</td>
      <td>0.011931</td>
      <td>0.006404</td>
      <td>-0.000016</td>
      <td>0.002230</td>
      <td>0.001607</td>
      <td>-0.747808</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-1.477174e-07</td>
      <td>5.824844e-02</td>
      <td>0.058345</td>
      <td>-5.678647e-06</td>
      <td>-1.792256e-02</td>
      <td>0.000000e+00</td>
      <td>-3.835240e-08</td>
      <td>5.935779e-02</td>
      <td>-5.602610e-02</td>
    </tr>
    <tr>
      <th>2018-06</th>
      <td>-0.638526</td>
      <td>-0.298185</td>
      <td>0.119805</td>
      <td>0.006146</td>
      <td>0.002783</td>
      <td>0.003984</td>
      <td>-0.000003</td>
      <td>0.002292</td>
      <td>0.003975</td>
      <td>2.965101</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-4.584712e-07</td>
      <td>-5.504241e-02</td>
      <td>-0.055167</td>
      <td>-1.079528e-05</td>
      <td>1.824964e-02</td>
      <td>4.688094e-03</td>
      <td>5.934540e-02</td>
      <td>-1.001436e-06</td>
      <td>-5.376251e-07</td>
    </tr>
    <tr>
      <th>2018-07</th>
      <td>-1.217032</td>
      <td>-0.238151</td>
      <td>0.072111</td>
      <td>0.037288</td>
      <td>-0.000037</td>
      <td>0.004275</td>
      <td>-0.000006</td>
      <td>0.002055</td>
      <td>0.004761</td>
      <td>-0.000014</td>
      <td>...</td>
      <td>-2.431712e-02</td>
      <td>5.818918e-02</td>
      <td>5.825105e-02</td>
      <td>-0.000062</td>
      <td>-6.438694e-06</td>
      <td>0.000000e+00</td>
      <td>-4.666219e-03</td>
      <td>-5.602098e-02</td>
      <td>-1.648371e-02</td>
      <td>-3.049877e-07</td>
    </tr>
    <tr>
      <th>2018-08</th>
      <td>3.947398</td>
      <td>-0.246398</td>
      <td>0.066575</td>
      <td>0.016498</td>
      <td>0.004426</td>
      <td>0.006201</td>
      <td>-0.793305</td>
      <td>0.002338</td>
      <td>0.002543</td>
      <td>-0.000049</td>
      <td>...</td>
      <td>2.492318e-02</td>
      <td>-5.498983e-02</td>
      <td>-5.504475e-02</td>
      <td>-0.000038</td>
      <td>-7.020437e-06</td>
      <td>-1.792259e-02</td>
      <td>0.000000e+00</td>
      <td>1.369548e-02</td>
      <td>0.000000e+00</td>
      <td>-4.427295e-07</td>
    </tr>
    <tr>
      <th>2018-09</th>
      <td>0.960735</td>
      <td>-0.554380</td>
      <td>0.092355</td>
      <td>0.036654</td>
      <td>-0.000285</td>
      <td>0.007940</td>
      <td>-0.000036</td>
      <td>0.002343</td>
      <td>0.003453</td>
      <td>-0.747815</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>5.819063e-02</td>
      <td>5.825139e-02</td>
      <td>-0.000048</td>
      <td>-6.066228e-06</td>
      <td>5.931917e-02</td>
      <td>0.000000e+00</td>
      <td>-1.351088e-02</td>
      <td>-4.021125e-02</td>
      <td>1.047344e-02</td>
    </tr>
    <tr>
      <th>2018-10</th>
      <td>-0.429730</td>
      <td>1.133518</td>
      <td>0.070241</td>
      <td>0.011980</td>
      <td>0.002376</td>
      <td>0.005262</td>
      <td>0.000039</td>
      <td>0.003030</td>
      <td>0.003965</td>
      <td>2.963844</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-5.499083e-02</td>
      <td>7.067271e-07</td>
      <td>-0.000052</td>
      <td>-1.116634e-05</td>
      <td>-3.876972e-02</td>
      <td>4.688245e-03</td>
      <td>-1.496293e-07</td>
      <td>4.189594e-02</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2018-11</th>
      <td>1.736956</td>
      <td>-1.168496</td>
      <td>0.112106</td>
      <td>0.013884</td>
      <td>0.002088</td>
      <td>0.006646</td>
      <td>0.001305</td>
      <td>0.003990</td>
      <td>0.001307</td>
      <td>-0.747958</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-2.243119e-07</td>
      <td>1.804945e-06</td>
      <td>-0.000063</td>
      <td>-8.151791e-06</td>
      <td>4.033373e-02</td>
      <td>1.727462e-07</td>
      <td>1.369608e-02</td>
      <td>1.676006e-02</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2018-12</th>
      <td>0.022899</td>
      <td>-0.156085</td>
      <td>0.127976</td>
      <td>0.055812</td>
      <td>0.011196</td>
      <td>0.008544</td>
      <td>-0.000766</td>
      <td>-0.005177</td>
      <td>0.002596</td>
      <td>-0.000643</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-4.773468e-07</td>
      <td>1.354384e-06</td>
      <td>-0.000056</td>
      <td>-5.740306e-06</td>
      <td>-5.599868e-02</td>
      <td>5.624593e-08</td>
      <td>4.503430e-02</td>
      <td>9.464689e-08</td>
      <td>-1.036507e-02</td>
    </tr>
    <tr>
      <th>2019-01</th>
      <td>-0.461625</td>
      <td>-7.666434</td>
      <td>0.116601</td>
      <td>0.065327</td>
      <td>0.033895</td>
      <td>0.014248</td>
      <td>0.005046</td>
      <td>0.002171</td>
      <td>0.008938</td>
      <td>0.004826</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-2.575486e-07</td>
      <td>-5.504868e-02</td>
      <td>-0.000101</td>
      <td>-5.603996e-02</td>
      <td>-4.109150e-07</td>
      <td>9.012279e-08</td>
      <td>-4.309361e-02</td>
      <td>-8.656517e-06</td>
      <td>-4.561259e-07</td>
    </tr>
    <tr>
      <th>2019-02</th>
      <td>-0.981924</td>
      <td>1.085686</td>
      <td>-0.000369</td>
      <td>0.007582</td>
      <td>5.329817</td>
      <td>0.000055</td>
      <td>0.001502</td>
      <td>0.001291</td>
      <td>-0.001948</td>
      <td>-0.000161</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-1.719271e-07</td>
      <td>2.741247e-02</td>
      <td>-0.000047</td>
      <td>5.936182e-02</td>
      <td>-6.848585e-07</td>
      <td>1.029236e-07</td>
      <td>0.000000e+00</td>
      <td>-6.398890e-06</td>
      <td>-3.020295e-08</td>
    </tr>
    <tr>
      <th>2019-03</th>
      <td>43.259870</td>
      <td>-0.388755</td>
      <td>0.072323</td>
      <td>0.004594</td>
      <td>-0.000022</td>
      <td>0.005977</td>
      <td>3.803372</td>
      <td>0.000789</td>
      <td>0.000883</td>
      <td>0.001062</td>
      <td>...</td>
      <td>-2.431716e-02</td>
      <td>-3.197816e-07</td>
      <td>-2.668109e-02</td>
      <td>-0.000050</td>
      <td>-8.580194e-06</td>
      <td>-5.478872e-07</td>
      <td>-5.600413e-02</td>
      <td>0.000000e+00</td>
      <td>-5.601827e-02</td>
      <td>-3.137559e-07</td>
    </tr>
    <tr>
      <th>2019-04</th>
      <td>0.267716</td>
      <td>-0.151062</td>
      <td>0.077819</td>
      <td>0.013692</td>
      <td>-0.841664</td>
      <td>0.004129</td>
      <td>-0.791690</td>
      <td>0.005811</td>
      <td>0.000019</td>
      <td>0.010447</td>
      <td>...</td>
      <td>-7.203858e-08</td>
      <td>5.819767e-02</td>
      <td>2.741249e-02</td>
      <td>-0.000053</td>
      <td>-7.436312e-06</td>
      <td>1.825238e-02</td>
      <td>5.932716e-02</td>
      <td>-1.351127e-02</td>
      <td>-8.138105e-07</td>
      <td>-1.508422e-07</td>
    </tr>
    <tr>
      <th>2019-05</th>
      <td>1.509738</td>
      <td>-1.417410</td>
      <td>0.009295</td>
      <td>0.012197</td>
      <td>0.031822</td>
      <td>0.002857</td>
      <td>0.001799</td>
      <td>0.000606</td>
      <td>0.000518</td>
      <td>0.005955</td>
      <td>...</td>
      <td>2.492329e-02</td>
      <td>-5.499701e-02</td>
      <td>-2.668115e-02</td>
      <td>-0.000064</td>
      <td>-6.169790e-06</td>
      <td>-1.792561e-02</td>
      <td>2.401118e-07</td>
      <td>1.369633e-02</td>
      <td>5.934323e-02</td>
      <td>-1.575197e-07</td>
    </tr>
    <tr>
      <th>2019-06</th>
      <td>-0.128050</td>
      <td>-1.135284</td>
      <td>0.100416</td>
      <td>0.010527</td>
      <td>0.011498</td>
      <td>0.002804</td>
      <td>0.001839</td>
      <td>0.001067</td>
      <td>0.003929</td>
      <td>0.002153</td>
      <td>...</td>
      <td>-2.431727e-02</td>
      <td>-4.790175e-07</td>
      <td>2.741255e-02</td>
      <td>-0.000064</td>
      <td>-6.150446e-06</td>
      <td>1.825280e-02</td>
      <td>1.792110e-07</td>
      <td>-1.351303e-02</td>
      <td>-5.602128e-02</td>
      <td>5.935466e-02</td>
    </tr>
    <tr>
      <th>2019-07</th>
      <td>0.456139</td>
      <td>-15.286578</td>
      <td>0.069629</td>
      <td>0.005527</td>
      <td>0.004664</td>
      <td>0.008494</td>
      <td>0.010210</td>
      <td>0.001348</td>
      <td>0.003296</td>
      <td>0.002975</td>
      <td>...</td>
      <td>2.492333e-02</td>
      <td>-1.914862e-07</td>
      <td>0.000000e+00</td>
      <td>0.059077</td>
      <td>-1.827094e-05</td>
      <td>0.000000e+00</td>
      <td>1.448170e-07</td>
      <td>1.369813e-02</td>
      <td>4.189964e-02</td>
      <td>-5.602988e-02</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>0.179017</td>
      <td>0.603170</td>
      <td>0.062230</td>
      <td>0.010409</td>
      <td>0.011469</td>
      <td>0.002771</td>
      <td>0.000520</td>
      <td>0.001063</td>
      <td>0.002774</td>
      <td>2.863659</td>
      <td>...</td>
      <td>0.000000e+00</td>
      <td>-4.486590e-07</td>
      <td>0.000000e+00</td>
      <td>-0.000062</td>
      <td>-7.057858e-06</td>
      <td>4.033682e-02</td>
      <td>1.163707e-07</td>
      <td>0.000000e+00</td>
      <td>1.674266e-02</td>
      <td>-2.166397e-07</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>-0.067849</td>
      <td>0.458362</td>
      <td>0.018427</td>
      <td>0.007912</td>
      <td>4.954796</td>
      <td>0.002347</td>
      <td>0.003063</td>
      <td>0.001691</td>
      <td>-0.000092</td>
      <td>-0.740863</td>
      <td>...</td>
      <td>3.242223e-02</td>
      <td>-9.601670e-08</td>
      <td>0.000000e+00</td>
      <td>-0.055864</td>
      <td>-2.246002e-03</td>
      <td>-5.600356e-02</td>
      <td>-4.667925e-03</td>
      <td>0.000000e+00</td>
      <td>-1.646696e-02</td>
      <td>-1.923678e-07</td>
    </tr>
  </tbody>
</table>
<p>25 rows × 302 columns</p>
</div>




```python

# 设置组合权重，存储为numpy数组类型
portfolio_weights = np.array([0, 0, 0.009434771695886534, 0.0012496174805247623, 0, 0.0016820603709608011, 0, 0, 0, 0.006629489428524694, 0.007295601329473488, 0, 0.009166380614804973, 0.005277638549334832, 0.004317937268932065, 0.007916192786272959, 0, 0.007380329186673191, 0.00258399072581293, 0.0034072898838984744, 0.009516428341063813, 0, 0, 0.0026783476043513816, 0.0016371663220342758, 0.0036398609338490154, 0.003709130649878039, 0, 0.00859520151267859, 0, 0.007380482169231893, 0.004443235308519927, 0.0022552915487597867, 0.001905493095152731, 0.0066912981479532625, 0, 0.003280155748263657, 0, 0, 0.0019240914187643168, 0, 0, 0.0017898723346775201, 0.008029557049417883, 0.005846353073334775, 0, 0, 0.003107363259660907, 0.009576898386829586, 0.006411788016175165, 0.0058978737138311674, 0.005978068818863912, 0.0024446891725550647, 0.00386641132707429, 0.00982909464390129, 0.008249128889463601, 0.002295027289607716, 0, 0.00584920525708898, 0.005680980595354006, 0.0035805880555816304, 0, 0.0012319241470676958, 0, 0, 0.0024848393611063644, 0.005754191675256485, 0.008263204809146565, 0.006143877580414785, 0, 0.00312045166565804, 0.003985128749477654, 0, 0.0011737752071815212, 0.00895579297678463, 0.008757538261371616, 0.009313867040164202, 0.004158520331103883, 0, 0.006126782802867048, 0, 0.0021167447054523877, 0, 0, 0.007829520186818295, 0.003429500679351707, 0, 0.00980379183083202, 0, 0.002866778577969769, 0, 0.009739213259455638, 0, 0.009474001516135942, 0, 0.0019930368340752786, 0, 0.004331644587989906, 0, 0.0036729231121406113, 0.0033051736079880703, 0, 0, 0.008010207905137531, 0, 0.009594386934384278, 0.006845720625999612, 0.004538832185107929, 0.008478308585406902, 0.00743375440982448, 0.006940780417137244, 0.009762336087574031, 0.008724252068840668, 0.004846647217115942, 0, 0.007503774013206098, 0, 0.005078748865960623, 0, 0.0021696436359868554, 0.006402353083137466, 0.0030212359542058018, 0, 0, 0.003039510587476217, 0, 0, 0, 0, 0, 0.004036382462482353, 0.0015504349661919535, 0, 0.008464554601622886, 0.009510344674642582, 0, 0, 0.005541959051409276, 0.0036706115476331617, 0, 0, 0.008898742146213369, 0.0035211048741913445, 0.0019681928022924084, 0.008405442363142154, 0.009009159298312884, 0.0021385156627264255, 0, 0, 0, 0, 0, 0.008240242253163896, 0.0029759739324058095, 0.00691272368538535, 0.0010454329325771969, 0, 0, 0, 0.004494058385915518, 0, 0.006216801579007778, 0.004468021756227918, 0.0032701460317816383, 0, 0.00932717593928364, 0, 0.009083829776772988, 0, 0.0036266985339565216, 0, 0.004176286926349674, 0.008421809694011677, 0.005225688276826423, 0.0028671800461043933, 0, 0.0022410841235814575, 0.00994235945536719, 0, 0, 0, 0, 0, 0.0037039867073871374, 0, 0.006620627849128733, 0.005315947733309678, 0, 0.003154821756332977, 0.006761465595578043, 0.005744635096492757, 0.008662441974484188, 0, 0.0018637523750924829, 0.005450604356674028, 0.009016251903871692, 0, 0, 0.009621599658597307, 0.005842839169992058, 0, 0.007446529225610412, 0, 0.004611685146681864, 0.003853485736162803, 0.006849725895167293, 0, 0.007323064108939128, 0, 0.001289256666950856, 0.0068197745910047085, 0.005179975818022108, 0.007763512779771549, 0.0040858204110692815, 0.007495180279845098, 0.0021425735610219807, 0, 0, 0.007496071836754703, 0.009987746565776213, 0, 0.0016059147602651407, 0.002656742911144809, 0, 0, 0.009999032385964949, 0.008296796317019888, 0, 0, 0, 0.0011372297603807354, 0, 0, 0, 0, 0, 0, 0, 0.002821243645651087, 0.008001931705742989, 0.005399774713302103, 0.002209922722293752, 0, 0, 0.008496441567201932, 0, 0.0016312622365661322, 0.006562402707525718, 0.00644258999458908, 0.006812826384480157, 0, 0.0068975431759576615, 0.005390481720869264, 0.001005450670607808, 0.005909516079097087, 0.006263216816654012, 0.007169785899938209, 0, 0, 0, 0, 0.0026167238974939347, 0, 0, 0.004397612578299686, 0, 0.0036656887930992684, 0, 0, 0.0015773926558498978, 0.0029438214922388123, 0.0016392085273475411, 0.008892284056364587, 0, 0.005846753116367307, 0.008182196206123583, 0, 0.007729836709010494, 0.007070434297671923, 0.005356576248807204, 0.006500561205612444, 0.007085805475930157, 0, 0, 0, 0, 0.0027182408323886058, 0, 0, 0.004005347110694082, 0.001188186559391267, 0.007738128460569692, 0.008137886601645026, 0, 0.00366671354836147, 0.004868001233983657, 0.0026205827353468136, 0.009501688882373908, 0.0032225135985835683, 0.005403754611322803, 0.0023331164531799767, 0.007629800251736207])
# 计算加权的股票收益
WeightedReturns = company_return.mul(portfolio_weights, axis=1)
# 计算投资组合的收益
CompanyReturns['Portfolio'] = WeightedReturns.sum(axis=1)
# 打印前5行数据
print(CompanyReturns.head())
 
# 绘制组合收益随时间变化的图
CompanyReturns.Portfolio.plot()
plt.show()
```

                 E124      E125      E126      E127      E128      E129      E130  \
    date                                                                            
    2017-09  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000   
    2017-10 -2.784220  0.961517  0.339445  0.017286  0.000080  0.009125 -0.000008   
    2017-11  1.254358  0.402813  0.549041  0.018953  0.000405  0.016391 -0.000011   
    2017-12  2.658917  1.387257  0.399743  0.108456 -0.000328  0.010202  0.000132   
    2018-01 -0.634483 -0.468596  0.235881  0.049798  0.007000  0.005862  3.837888   
    
                 E131      E132      E133  ...          E417          E418  \
    date                                   ...                               
    2017-09  0.000000  0.000000  0.000000  ...  0.000000e+00  0.000000e+00   
    2017-10  0.001501  0.001565 -0.000064  ... -5.744562e-08  0.000000e+00   
    2017-11  0.002286  0.002107 -0.000072  ...  9.696398e-03 -2.667691e-02   
    2017-12 -0.001163  0.002645 -0.000608  ...  4.802326e-02 -1.213204e-07   
    2018-01  0.003883  0.005024 -0.747978  ... -5.498614e-02  5.823773e-02   
    
                 E419      E420      E421  E422      E423          E424  E425  \
    date                                                                        
    2017-09  0.000000  0.000000  0.000000   0.0  0.000000  0.000000e+00   0.0   
    2017-10 -0.000001 -0.000006 -0.017923   0.0  0.013691  0.000000e+00   0.0   
    2017-11 -0.000021 -0.000012  0.018250   0.0 -0.013508  1.675779e-02   0.0   
    2017-12 -0.000007 -0.000003  0.040312   0.0 -0.000001  2.769927e-07   0.0   
    2018-01 -0.000007 -0.000013 -0.038750   0.0  0.013694  4.741146e-08   0.0   
    
             Portfolio  
    date                
    2017-09   0.000000  
    2017-10   0.030008  
    2017-11  -0.001796  
    2017-12   0.019171  
    2018-01  -0.012902  
    
    [5 rows x 303 columns]



![png](output_23_1.png)



```python
# 定义累积收益曲线绘制函数
def cumulative_returns_plot(name_list):
    for name in name_list:
        CumulativeReturns = ((1+CompanyReturns[name]).cumprod()-1)
        CumulativeReturns.plot(label=name)
    plt.legend()
    plt.show()
# 计算累积的组合收益，并绘图
cumulative_returns_plot(['Portfolio'])
```


![png](output_24_0.png)



```python
# 设置投资组合中公司的数目
numcompanies = 302
# 平均分配每一项的权重
portfolio_weights_ew = np.repeat(1/numcompanies, numcompanies)
# 计算等权重组合的收益
CompanyReturns['Portfolio_EW'] = company_return.mul(portfolio_weights_ew, axis=1).sum(axis=1)
# 打印前5行数据
print(CompanyReturns.head())
# 绘制累积收益曲线
cumulative_returns_plot(['Portfolio','Portfolio_EW'])
```

                 E124      E125      E126      E127      E128      E129      E130  \
    date                                                                            
    2017-09  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000  0.000000   
    2017-10 -2.784220  0.961517  0.339445  0.017286  0.000080  0.009125 -0.000008   
    2017-11  1.254358  0.402813  0.549041  0.018953  0.000405  0.016391 -0.000011   
    2017-12  2.658917  1.387257  0.399743  0.108456 -0.000328  0.010202  0.000132   
    2018-01 -0.634483 -0.468596  0.235881  0.049798  0.007000  0.005862  3.837888   
    
                 E131      E132      E133  ...          E418      E419      E420  \
    date                                   ...                                     
    2017-09  0.000000  0.000000  0.000000  ...  0.000000e+00  0.000000  0.000000   
    2017-10  0.001501  0.001565 -0.000064  ...  0.000000e+00 -0.000001 -0.000006   
    2017-11  0.002286  0.002107 -0.000072  ... -2.667691e-02 -0.000021 -0.000012   
    2017-12 -0.001163  0.002645 -0.000608  ... -1.213204e-07 -0.000007 -0.000003   
    2018-01  0.003883  0.005024 -0.747978  ...  5.823773e-02 -0.000007 -0.000013   
    
                 E421  E422      E423          E424  E425  Portfolio  Portfolio_EW  
    date                                                                            
    2017-09  0.000000   0.0  0.000000  0.000000e+00   0.0   0.000000      0.000000  
    2017-10 -0.017923   0.0  0.013691  0.000000e+00   0.0   0.030008      0.011792  
    2017-11  0.018250   0.0 -0.013508  1.675779e-02   0.0  -0.001796      0.003655  
    2017-12  0.040312   0.0 -0.000001  2.769927e-07   0.0   0.019171      0.022205  
    2018-01 -0.038750   0.0  0.013694  4.741146e-08   0.0  -0.012902      0.007600  
    
    [5 rows x 304 columns]



![png](output_25_1.png)



```python
# 计算相关矩阵
correlation_matrix = company_return.corr()
# 输出相关矩阵
correlation_matrix
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>E124</th>
      <th>E125</th>
      <th>E126</th>
      <th>E127</th>
      <th>E128</th>
      <th>E129</th>
      <th>E130</th>
      <th>E131</th>
      <th>E132</th>
      <th>E133</th>
      <th>...</th>
      <th>E416</th>
      <th>E417</th>
      <th>E418</th>
      <th>E419</th>
      <th>E420</th>
      <th>E421</th>
      <th>E422</th>
      <th>E423</th>
      <th>E424</th>
      <th>E425</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>E124</th>
      <td>1.000000</td>
      <td>0.032927</td>
      <td>-0.060606</td>
      <td>-0.130097</td>
      <td>-0.084469</td>
      <td>0.017270</td>
      <td>0.637735</td>
      <td>-0.082938</td>
      <td>-0.143562</td>
      <td>-0.081644</td>
      <td>...</td>
      <td>-0.321770</td>
      <td>-0.018895</td>
      <td>-0.166229</td>
      <td>0.041476</td>
      <td>-0.009929</td>
      <td>0.036461</td>
      <td>-0.689559</td>
      <td>0.011658</td>
      <td>-0.326794</td>
      <td>-0.034754</td>
    </tr>
    <tr>
      <th>E125</th>
      <td>0.032927</td>
      <td>1.000000</td>
      <td>0.133854</td>
      <td>0.046056</td>
      <td>0.137341</td>
      <td>-0.287486</td>
      <td>0.025133</td>
      <td>-0.036692</td>
      <td>-0.387208</td>
      <td>0.132613</td>
      <td>...</td>
      <td>-0.250482</td>
      <td>0.030780</td>
      <td>0.146314</td>
      <td>-0.444585</td>
      <td>0.358356</td>
      <td>-0.030536</td>
      <td>0.013492</td>
      <td>0.061426</td>
      <td>-0.193257</td>
      <td>0.368656</td>
    </tr>
    <tr>
      <th>E126</th>
      <td>-0.060606</td>
      <td>0.133854</td>
      <td>1.000000</td>
      <td>0.451694</td>
      <td>-0.241941</td>
      <td>0.718344</td>
      <td>0.100356</td>
      <td>-0.017597</td>
      <td>0.200464</td>
      <td>-0.152475</td>
      <td>...</td>
      <td>-0.141784</td>
      <td>0.159941</td>
      <td>0.014746</td>
      <td>0.030309</td>
      <td>-0.128049</td>
      <td>0.169383</td>
      <td>0.012045</td>
      <td>0.048482</td>
      <td>0.087034</td>
      <td>0.014988</td>
    </tr>
    <tr>
      <th>E127</th>
      <td>-0.130097</td>
      <td>0.046056</td>
      <td>0.451694</td>
      <td>1.000000</td>
      <td>-0.192947</td>
      <td>0.481819</td>
      <td>0.054854</td>
      <td>-0.309394</td>
      <td>0.452160</td>
      <td>-0.208776</td>
      <td>...</td>
      <td>-0.396212</td>
      <td>0.277122</td>
      <td>0.140839</td>
      <td>0.131129</td>
      <td>-0.332607</td>
      <td>0.064137</td>
      <td>0.035190</td>
      <td>-0.122420</td>
      <td>0.019119</td>
      <td>-0.076399</td>
    </tr>
    <tr>
      <th>E128</th>
      <td>-0.084469</td>
      <td>0.137341</td>
      <td>-0.241941</td>
      <td>-0.192947</td>
      <td>1.000000</td>
      <td>-0.356642</td>
      <td>-0.042615</td>
      <td>-0.064662</td>
      <td>-0.420504</td>
      <td>-0.161175</td>
      <td>...</td>
      <td>0.255960</td>
      <td>-0.050684</td>
      <td>0.083780</td>
      <td>-0.344527</td>
      <td>0.524830</td>
      <td>-0.288852</td>
      <td>-0.128030</td>
      <td>0.001815</td>
      <td>-0.077999</td>
      <td>0.001138</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>E421</th>
      <td>0.036461</td>
      <td>-0.030536</td>
      <td>0.169383</td>
      <td>0.064137</td>
      <td>-0.288852</td>
      <td>0.119157</td>
      <td>-0.191837</td>
      <td>0.236194</td>
      <td>0.049876</td>
      <td>0.079470</td>
      <td>...</td>
      <td>-0.428650</td>
      <td>0.575269</td>
      <td>0.041702</td>
      <td>0.066014</td>
      <td>0.010834</td>
      <td>1.000000</td>
      <td>0.106796</td>
      <td>-0.195435</td>
      <td>-0.209501</td>
      <td>0.197597</td>
    </tr>
    <tr>
      <th>E422</th>
      <td>-0.689559</td>
      <td>0.013492</td>
      <td>0.012045</td>
      <td>0.035190</td>
      <td>-0.128030</td>
      <td>-0.061815</td>
      <td>-0.590055</td>
      <td>0.381759</td>
      <td>-0.045601</td>
      <td>0.063464</td>
      <td>...</td>
      <td>0.196614</td>
      <td>0.226621</td>
      <td>0.165006</td>
      <td>0.000121</td>
      <td>0.001540</td>
      <td>0.106796</td>
      <td>1.000000</td>
      <td>-0.024360</td>
      <td>0.276788</td>
      <td>0.000052</td>
    </tr>
    <tr>
      <th>E423</th>
      <td>0.011658</td>
      <td>0.061426</td>
      <td>0.048482</td>
      <td>-0.122420</td>
      <td>0.001815</td>
      <td>-0.166769</td>
      <td>0.065700</td>
      <td>-0.257870</td>
      <td>-0.242338</td>
      <td>0.202390</td>
      <td>...</td>
      <td>0.288926</td>
      <td>-0.347827</td>
      <td>0.001696</td>
      <td>-0.162818</td>
      <td>0.223146</td>
      <td>-0.195435</td>
      <td>-0.024360</td>
      <td>1.000000</td>
      <td>0.369034</td>
      <td>0.032170</td>
    </tr>
    <tr>
      <th>E424</th>
      <td>-0.326794</td>
      <td>-0.193257</td>
      <td>0.087034</td>
      <td>0.019119</td>
      <td>-0.077999</td>
      <td>0.061180</td>
      <td>-0.261067</td>
      <td>0.084790</td>
      <td>-0.045399</td>
      <td>0.116187</td>
      <td>...</td>
      <td>0.406832</td>
      <td>-0.361736</td>
      <td>0.103856</td>
      <td>0.391275</td>
      <td>0.002903</td>
      <td>-0.209501</td>
      <td>0.276788</td>
      <td>0.369034</td>
      <td>1.000000</td>
      <td>-0.460603</td>
    </tr>
    <tr>
      <th>E425</th>
      <td>-0.034754</td>
      <td>0.368656</td>
      <td>0.014988</td>
      <td>-0.076399</td>
      <td>0.001138</td>
      <td>-0.125377</td>
      <td>0.000673</td>
      <td>0.023790</td>
      <td>-0.039709</td>
      <td>0.006451</td>
      <td>...</td>
      <td>-0.296967</td>
      <td>0.033326</td>
      <td>0.134582</td>
      <td>-0.493099</td>
      <td>0.000131</td>
      <td>0.197597</td>
      <td>0.000052</td>
      <td>0.032170</td>
      <td>-0.460603</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>302 rows × 302 columns</p>
</div>




```python
#创建热图
plt.figure(figsize=(80, 100))
sns.heatmap(correlation_matrix,cmap='rainbow',linewidths=0.005)
plt.xticks(rotation=0)
plt.yticks(rotation=75)
plt.show()
```


![png](output_27_0.png)



```python
# 计算协方差矩阵
cov_mat = company_return.cov()

# 输出协方差矩阵
cov_mat
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>E124</th>
      <th>E125</th>
      <th>E126</th>
      <th>E127</th>
      <th>E128</th>
      <th>E129</th>
      <th>E130</th>
      <th>E131</th>
      <th>E132</th>
      <th>E133</th>
      <th>...</th>
      <th>E416</th>
      <th>E417</th>
      <th>E418</th>
      <th>E419</th>
      <th>E420</th>
      <th>E421</th>
      <th>E422</th>
      <th>E423</th>
      <th>E424</th>
      <th>E425</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>E124</th>
      <td>75.650533</td>
      <td>0.987067</td>
      <td>-0.069222</td>
      <td>-0.027675</td>
      <td>-1.060248</td>
      <td>0.000590</td>
      <td>6.094401</td>
      <td>-0.001422</td>
      <td>-0.002759</td>
      <td>-0.854738</td>
      <td>...</td>
      <td>-0.046679</td>
      <td>-0.005267</td>
      <td>-0.056374</td>
      <td>8.414378e-03</td>
      <td>-1.439566e-03</td>
      <td>0.009221</td>
      <td>-1.005324e-01</td>
      <td>0.002742</td>
      <td>-0.088982</td>
      <td>-7.208215e-03</td>
    </tr>
    <tr>
      <th>E125</th>
      <td>0.987067</td>
      <td>11.879082</td>
      <td>0.060583</td>
      <td>0.003882</td>
      <td>0.683120</td>
      <td>-0.003891</td>
      <td>0.095173</td>
      <td>-0.000249</td>
      <td>-0.002949</td>
      <td>0.550150</td>
      <td>...</td>
      <td>-0.014399</td>
      <td>0.003400</td>
      <td>0.019663</td>
      <td>-3.574100e-02</td>
      <td>2.058928e-02</td>
      <td>-0.003060</td>
      <td>7.794857e-04</td>
      <td>0.005725</td>
      <td>-0.020852</td>
      <td>3.029934e-02</td>
    </tr>
    <tr>
      <th>E126</th>
      <td>-0.069222</td>
      <td>0.060583</td>
      <td>0.017244</td>
      <td>0.001451</td>
      <td>-0.045850</td>
      <td>0.000370</td>
      <td>0.014480</td>
      <td>-0.000005</td>
      <td>0.000058</td>
      <td>-0.024100</td>
      <td>...</td>
      <td>-0.000311</td>
      <td>0.000673</td>
      <td>0.000076</td>
      <td>9.283659e-05</td>
      <td>-2.803074e-04</td>
      <td>0.000647</td>
      <td>2.651246e-05</td>
      <td>0.000172</td>
      <td>0.000358</td>
      <td>4.693520e-05</td>
    </tr>
    <tr>
      <th>E127</th>
      <td>-0.027675</td>
      <td>0.003882</td>
      <td>0.001451</td>
      <td>0.000598</td>
      <td>-0.006810</td>
      <td>0.000046</td>
      <td>0.001474</td>
      <td>-0.000015</td>
      <td>0.000024</td>
      <td>-0.006146</td>
      <td>...</td>
      <td>-0.000162</td>
      <td>0.000217</td>
      <td>0.000134</td>
      <td>7.480430e-05</td>
      <td>-1.356045e-04</td>
      <td>0.000046</td>
      <td>1.442638e-05</td>
      <td>-0.000081</td>
      <td>0.000015</td>
      <td>-4.455722e-05</td>
    </tr>
    <tr>
      <th>E128</th>
      <td>-1.060248</td>
      <td>0.683120</td>
      <td>-0.045850</td>
      <td>-0.006810</td>
      <td>2.082620</td>
      <td>-0.002021</td>
      <td>-0.067571</td>
      <td>-0.000184</td>
      <td>-0.001341</td>
      <td>-0.279966</td>
      <td>...</td>
      <td>0.006161</td>
      <td>-0.002344</td>
      <td>0.004714</td>
      <td>-1.159708e-02</td>
      <td>1.262578e-02</td>
      <td>-0.012120</td>
      <td>-3.097021e-03</td>
      <td>0.000071</td>
      <td>-0.003524</td>
      <td>3.916640e-05</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>E421</th>
      <td>0.009221</td>
      <td>-0.003060</td>
      <td>0.000647</td>
      <td>0.000046</td>
      <td>-0.012120</td>
      <td>0.000014</td>
      <td>-0.006128</td>
      <td>0.000014</td>
      <td>0.000003</td>
      <td>0.002781</td>
      <td>...</td>
      <td>-0.000208</td>
      <td>0.000536</td>
      <td>0.000047</td>
      <td>4.476975e-05</td>
      <td>5.250928e-06</td>
      <td>0.000845</td>
      <td>5.204915e-05</td>
      <td>-0.000154</td>
      <td>-0.000191</td>
      <td>1.370035e-04</td>
    </tr>
    <tr>
      <th>E422</th>
      <td>-0.100532</td>
      <td>0.000779</td>
      <td>0.000027</td>
      <td>0.000014</td>
      <td>-0.003097</td>
      <td>-0.000004</td>
      <td>-0.010867</td>
      <td>0.000013</td>
      <td>-0.000002</td>
      <td>0.001280</td>
      <td>...</td>
      <td>0.000055</td>
      <td>0.000122</td>
      <td>0.000108</td>
      <td>4.726791e-08</td>
      <td>4.304267e-07</td>
      <td>0.000052</td>
      <td>2.809684e-04</td>
      <td>-0.000011</td>
      <td>0.000145</td>
      <td>2.067582e-08</td>
    </tr>
    <tr>
      <th>E423</th>
      <td>0.002742</td>
      <td>0.005725</td>
      <td>0.000172</td>
      <td>-0.000081</td>
      <td>0.000071</td>
      <td>-0.000018</td>
      <td>0.001952</td>
      <td>-0.000014</td>
      <td>-0.000014</td>
      <td>0.006587</td>
      <td>...</td>
      <td>0.000130</td>
      <td>-0.000301</td>
      <td>0.000002</td>
      <td>-1.026872e-04</td>
      <td>1.005816e-04</td>
      <td>-0.000154</td>
      <td>-1.104066e-05</td>
      <td>0.000731</td>
      <td>0.000312</td>
      <td>2.074282e-05</td>
    </tr>
    <tr>
      <th>E424</th>
      <td>-0.088982</td>
      <td>-0.020852</td>
      <td>0.000358</td>
      <td>0.000015</td>
      <td>-0.003524</td>
      <td>0.000008</td>
      <td>-0.008980</td>
      <td>0.000005</td>
      <td>-0.000003</td>
      <td>0.004378</td>
      <td>...</td>
      <td>0.000212</td>
      <td>-0.000363</td>
      <td>0.000127</td>
      <td>2.857077e-04</td>
      <td>1.515191e-06</td>
      <td>-0.000191</td>
      <td>1.452430e-04</td>
      <td>0.000312</td>
      <td>0.000980</td>
      <td>-3.438485e-04</td>
    </tr>
    <tr>
      <th>E425</th>
      <td>-0.007208</td>
      <td>0.030299</td>
      <td>0.000047</td>
      <td>-0.000045</td>
      <td>0.000039</td>
      <td>-0.000012</td>
      <td>0.000018</td>
      <td>0.000001</td>
      <td>-0.000002</td>
      <td>0.000185</td>
      <td>...</td>
      <td>-0.000118</td>
      <td>0.000025</td>
      <td>0.000125</td>
      <td>-2.742678e-04</td>
      <td>5.195952e-08</td>
      <td>0.000137</td>
      <td>2.067582e-08</td>
      <td>0.000021</td>
      <td>-0.000344</td>
      <td>5.686454e-04</td>
    </tr>
  </tbody>
</table>
<p>302 rows × 302 columns</p>
</div>




```python
# 设置模拟的次数
number = 9000
# 设置空的numpy数组，用于存储每次模拟得到的权重、收益率和标准差
random_p = np.empty((number, 304))
# 设置随机数种子，这里是为了结果可重复
np.random.seed(304)
 
#循环模拟9000次随机的投资组合
for i in range(number):
    #生成302个随机数，得到一组随机的权重数据
    random_weight=_random(0.001, 0.01, 302)
    
    #计算平均收益率
    mean_return=company_return.mul(random_weight,axis=1).sum(axis=1).mean()
 
    #计算年化标准差，也成为波动率
    random_volatility=np.sqrt(np.dot(random_weight ,np.dot(cov_mat,random_weight)))
 
    #将上面生成的权重，和计算得到的收益率、标准差存入数组random_p中
    random_p[i][:302]=random_weight
    random_p[i][302]=mean_return
    random_p[i][303]=random_volatility
 

 # 将Numpy数组转化为DataF数据框
RandomPortfolios=pd.DataFrame(random_p)
#设置数据框RandomPortfolios每一列的名称
RandomPortfolios.columns=[company +'_weight' for company in company_list]+['Returns','Volatility']
 
#绘制散点图
RandomPortfolios.plot('Volatility','Returns',kind='scatter',alpha=0.3)
plt.show()
```


![png](output_29_0.png)



```python
# 找到标准差最小数据的索引值
min_index = RandomPortfolios.Volatility.idxmin()
 
# 在收益-风险散点图中突出风险最小的点
RandomPortfolios.plot('Volatility', 'Returns', kind='scatter', alpha=0.3)
x = RandomPortfolios.loc[min_index,'Volatility']
y = RandomPortfolios.loc[min_index,'Returns']
plt.scatter(x, y, color='red')
#将该点坐标显示在图中并保留四位小数
plt.text(np.round(x,4),np.round(y,4),(np.round(x,4),np.round(y,4)),ha='left',va='bottom',fontsize=10)
plt.show()
```


![png](output_30_0.png)



```python
# 提取最小波动组合对应的权重, 并转换成Numpy数组
GMV_weights = np.array(RandomPortfolios.iloc[min_index, 0:numcompanies])
# 计算GMV投资组合收益
CompanyReturns['Portfolio_GMV'] = company_return.mul(GMV_weights, axis=1).sum(axis=1)
#输出风险最小投资组合的权重
print(GMV_weights)
```

    [0.         0.         0.         0.         0.         0.00517701
     0.         0.         0.00677059 0.         0.         0.
     0.         0.         0.         0.00899307 0.00885824 0.
     0.         0.         0.00125017 0.         0.         0.00223226
     0.         0.         0.         0.         0.00119821 0.
     0.         0.00817303 0.         0.         0.00999445 0.00332377
     0.00183165 0.00126035 0.0072624  0.         0.         0.
     0.         0.         0.         0.         0.         0.00140894
     0.00528842 0.         0.00761175 0.         0.00995134 0.00199347
     0.         0.00705457 0.         0.0048114  0.         0.00393489
     0.         0.00734016 0.         0.         0.00233731 0.00450239
     0.         0.0045684  0.         0.00186469 0.         0.00513958
     0.00759487 0.00449376 0.         0.         0.00720827 0.
     0.006354   0.         0.         0.         0.00502698 0.
     0.         0.         0.         0.         0.00497041 0.
     0.         0.         0.         0.         0.00157959 0.
     0.0035483  0.         0.00358841 0.         0.         0.00754756
     0.00862044 0.00769765 0.         0.         0.00813842 0.
     0.00122093 0.         0.00102108 0.00544835 0.         0.
     0.00924145 0.00440749 0.00499177 0.         0.00746638 0.
     0.         0.         0.00999016 0.         0.         0.
     0.         0.00283395 0.00273324 0.00391526 0.         0.
     0.         0.00275834 0.00585714 0.         0.         0.00834738
     0.00967717 0.         0.00354146 0.         0.         0.00548579
     0.         0.         0.         0.00633519 0.00131754 0.002546
     0.         0.00423299 0.00763076 0.00586183 0.00848447 0.
     0.         0.00391259 0.00384094 0.00867559 0.         0.00907959
     0.         0.         0.         0.         0.00462744 0.
     0.         0.         0.         0.         0.         0.
     0.00868035 0.         0.         0.00970307 0.00798004 0.
     0.         0.00961038 0.00970221 0.         0.         0.
     0.         0.         0.         0.00499387 0.         0.
     0.         0.         0.         0.         0.00251782 0.006794
     0.0058036  0.         0.         0.00236743 0.         0.00182583
     0.         0.00335035 0.00382397 0.00782074 0.         0.00905884
     0.         0.0039164  0.00167029 0.         0.00486603 0.
     0.         0.00324843 0.         0.         0.00460987 0.00320148
     0.00786148 0.         0.00628    0.         0.         0.00566696
     0.00833844 0.00144343 0.0040463  0.         0.         0.00240259
     0.         0.00333479 0.         0.         0.0010089  0.
     0.         0.         0.         0.         0.         0.
     0.         0.         0.00237324 0.00143565 0.00900569 0.0079207
     0.         0.         0.00675576 0.00577297 0.         0.
     0.         0.00271353 0.00921725 0.00218311 0.         0.0095565
     0.00343385 0.         0.         0.00650787 0.00386038 0.00521489
     0.         0.         0.         0.         0.         0.
     0.00470523 0.00634201 0.0014387  0.         0.         0.00428143
     0.00433699 0.         0.         0.         0.00631289 0.00868264
     0.00946819 0.         0.         0.         0.         0.
     0.         0.         0.         0.00990595 0.         0.
     0.         0.        ]



```python
# 设置无风险回报率为0
risk_free = 0
# 计算每项资产的夏普比率
RandomPortfolios['Sharpe'] = (RandomPortfolios.Returns - risk_free) / RandomPortfolios.Volatility
# 绘制收益-标准差的散点图，并用颜色描绘夏普比率
plt.scatter(RandomPortfolios.Volatility, RandomPortfolios.Returns, c=RandomPortfolios.Sharpe)
plt.colorbar(label='Sharpe Ratio')
plt.show()
```


![png](output_32_0.png)



```python
# 找到夏普比率最大数据对应的索引值
max_index = RandomPortfolios.Sharpe.idxmax()
# 在收益-风险散点图中突出夏普比率最大的点
RandomPortfolios.plot('Volatility', 'Returns', kind='scatter', alpha=0.3)
x = RandomPortfolios.loc[max_index,'Volatility']
y = RandomPortfolios.loc[max_index,'Returns']
plt.scatter(x, y, color='red')
#将该点坐标显示在图中并保留四位小数
plt.text(np.round(x,4),np.round(y,4),(np.round(x,4),np.round(y,4)),ha='left',va='bottom',fontsize=10)
plt.show()
```


![png](output_33_0.png)



```python
# 提取最大夏普比率组合对应的权重，并转化为numpy数组
MSR_weights = np.array(RandomPortfolios.iloc[max_index, 0:numcompanies])
# 计算MSR组合的收益
CompanyReturns['Portfolio_MSR'] = company_return.mul(MSR_weights, axis=1).sum(axis=1)
#输出夏普比率最大的投资组合的权重
print(MSR_weights)
```

    [0.         0.         0.00725014 0.0013453  0.         0.
     0.00515237 0.         0.00757142 0.00233683 0.00692271 0.
     0.         0.00491469 0.         0.         0.         0.00487636
     0.00247248 0.00922673 0.00265783 0.         0.         0.00932167
     0.         0.         0.0027955  0.         0.         0.00116558
     0.00792383 0.00976706 0.00469706 0.         0.00933008 0.00792396
     0.00420406 0.00201471 0.         0.00102224 0.00748118 0.00968287
     0.         0.00220953 0.         0.00805622 0.0064853  0.
     0.00843115 0.0028081  0.00702254 0.00108485 0.00681266 0.00326104
     0.         0.00361832 0.         0.00155162 0.00395733 0.0022952
     0.00529589 0.00630532 0.         0.         0.00612913 0.00771267
     0.         0.         0.         0.         0.00912294 0.00857172
     0.00676653 0.00134926 0.         0.00990096 0.00753989 0.00733493
     0.00294959 0.00322157 0.00748495 0.00202691 0.00553625 0.00697218
     0.00531188 0.00173241 0.0023781  0.00510053 0.00943    0.
     0.00167987 0.00400919 0.         0.         0.         0.
     0.         0.00442659 0.00813353 0.         0.         0.00513009
     0.         0.         0.         0.00239359 0.00843159 0.00205054
     0.00271421 0.00676351 0.00515749 0.         0.00525106 0.
     0.         0.00844393 0.00459959 0.         0.00947469 0.0021763
     0.00797156 0.00602213 0.00514844 0.         0.0057702  0.
     0.00870648 0.         0.         0.         0.         0.00270546
     0.         0.         0.00627454 0.00849977 0.00126506 0.
     0.         0.00781003 0.00123698 0.         0.         0.0094876
     0.00238277 0.         0.00744623 0.00718202 0.00344352 0.00691578
     0.         0.         0.00200669 0.00532765 0.         0.00873089
     0.00981552 0.         0.00165089 0.         0.00874579 0.00108006
     0.         0.00290175 0.0096338  0.00140899 0.00158125 0.
     0.         0.00392364 0.         0.00152175 0.         0.00596059
     0.         0.00774051 0.00476908 0.00940171 0.         0.00948975
     0.         0.00886718 0.         0.00269841 0.00908217 0.00330226
     0.00995019 0.         0.00910812 0.00320796 0.00409296 0.00288884
     0.00624299 0.         0.         0.         0.00197602 0.00356435
     0.0022371  0.         0.         0.00945877 0.00981215 0.00133611
     0.00330696 0.00167587 0.00430855 0.00997662 0.00537164 0.
     0.         0.         0.         0.00744568 0.         0.00319521
     0.         0.00782602 0.00546508 0.         0.0083157  0.00261265
     0.00942093 0.         0.00595819 0.00768339 0.00366973 0.00415653
     0.         0.00984432 0.00911314 0.         0.         0.
     0.         0.         0.00690717 0.         0.00422145 0.
     0.00786992 0.00602336 0.00569672 0.         0.00637861 0.00678401
     0.         0.00178699 0.         0.00425352 0.         0.
     0.00652139 0.00705884 0.00359965 0.00799338 0.         0.00900228
     0.         0.00228791 0.         0.         0.00118185 0.00211804
     0.         0.00415951 0.         0.         0.         0.00417651
     0.00395177 0.005588   0.00669002 0.00375008 0.00427467 0.00209361
     0.00156536 0.00960345 0.         0.00728988 0.00618303 0.
     0.00476092 0.00552271 0.00202029 0.         0.00397587 0.
     0.         0.         0.00379043 0.0037425  0.00923127 0.
     0.00885442 0.         0.00330287 0.00210845 0.00681184 0.00675768
     0.         0.        ]



```python
print(MSR_weights*10000)
```

    [ 0.          0.         72.50144306 13.45295646  0.          0.
     51.52368446  0.         75.71415767 23.36827195 69.22712647  0.
      0.         49.14686975  0.          0.          0.         48.763649
     24.724803   92.26726603 26.57830283  0.          0.         93.2167269
      0.          0.         27.95501288  0.          0.         11.6557828
     79.23828228 97.67060213 46.97060799  0.         93.30076543 79.23964729
     42.0406014  20.1470559   0.         10.22239396 74.81180758 96.82865787
      0.         22.09528311  0.         80.56221012 64.85297633  0.
     84.31147946 28.0810004  70.22544758 10.84849222 68.12658189 32.61038474
      0.         36.18324612  0.         15.51618451 39.5732579  22.95197118
     52.9589215  63.05322375  0.          0.         61.29125024 77.12674991
      0.          0.          0.          0.         91.22941449 85.71723072
     67.66531686 13.49264385  0.         99.00958642 75.39889087 73.34932749
     29.49591758 32.21572484 74.84952197 20.26911876 55.36249774 69.72184514
     53.1188072  17.32411806 23.78100634 51.00530142 94.29996265  0.
     16.79865262 40.09188132  0.          0.          0.          0.
      0.         44.2659287  81.33532107  0.          0.         51.30093824
      0.          0.          0.         23.9359171  84.31592084 20.50535374
     27.14210009 67.6350893  51.57485504  0.         52.51057155  0.
      0.         84.43931057 45.99585314  0.         94.74691382 21.76302404
     79.71560898 60.22125674 51.48440648  0.         57.70195081  0.
     87.06483951  0.          0.          0.          0.         27.05458568
      0.          0.         62.74540599 84.99768949 12.65063437  0.
      0.         78.10031116 12.36984167  0.          0.         94.87596965
     23.8276587   0.         74.46230527 71.8201786  34.43516973 69.15775504
      0.          0.         20.06689065 53.27647632  0.         87.30893091
     98.15521838  0.         16.50894329  0.         87.45786772 10.80057545
      0.         29.01748093 96.33804603 14.08985214 15.8124834   0.
      0.         39.2364204   0.         15.21752016  0.         59.60591952
      0.         77.40510804 47.69078473 94.01709959  0.         94.89747153
      0.         88.67179722  0.         26.98408993 90.82168319 33.02263029
     99.50185549  0.         91.08122757 32.07958971 40.92959042 28.8883734
     62.42987664  0.          0.          0.         19.76019909 35.64348697
     22.37097913  0.          0.         94.58765453 98.12146783 13.36107129
     33.06959676 16.75865101 43.0855351  99.7662452  53.71640308  0.
      0.          0.          0.         74.45675259  0.         31.9520907
      0.         78.2602065  54.65077191  0.         83.15696508 26.1264527
     94.20933986  0.         59.58190954 76.83394348 36.69733083 41.56526088
      0.         98.4432468  91.13137575  0.          0.          0.
      0.          0.         69.07170799  0.         42.21453086  0.
     78.69918168 60.23357113 56.9671791   0.         63.78610449 67.84014216
      0.         17.86990929  0.         42.5351707   0.          0.
     65.21390112 70.58839651 35.99645712 79.93377584  0.         90.02279485
      0.         22.87912953  0.          0.         11.81848441 21.18035786
      0.         41.59511133  0.          0.          0.         41.76507689
     39.51768724 55.87996564 66.90017977 37.50083763 42.74669708 20.93605975
     15.65357482 96.03451991  0.         72.89879306 61.83025293  0.
     47.60916691 55.22714395 20.20287039  0.         39.75867496  0.
      0.          0.         37.90430474 37.42499246 92.31270193  0.
     88.54415294  0.         33.02874499 21.08449472 68.1184453  67.57682098
      0.          0.        ]



```python
# 绘制累积收益曲线
cumulative_returns_plot(['Portfolio','Portfolio_EW','Portfolio_GMV','Portfolio_MSR'])
```


![png](output_36_0.png)



```python

```
